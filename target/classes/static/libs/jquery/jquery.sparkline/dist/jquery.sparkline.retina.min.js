!function(e,d,f){!function(b){"function"==typeof define&&define.amd?define(["jquery"],b):jQuery&&!jQuery.fn.sparkline&&b(jQuery)}(function(ar){var aq,ap,ao,an,am,al,ak,aj,ai,ah,ag,af,ad,ab,Z,X,V,T,R,P,N,c,ae,ac,aa,Y,W,U,S,Q,O,M,b={},a=0;aq=function(){return{common:{type:"line",lineColor:"#00f",fillColor:"#cdf",defaultPixelsPerValue:3,width:"auto",height:"auto",composite:!1,tagValuesAttribute:"values",tagOptionsPrefix:"spark",enableTagOptions:!1,enableHighlight:!0,highlightLighten:1.4,tooltipSkipNull:!0,tooltipPrefix:"",tooltipSuffix:"",disableHiddenCheck:!1,numberFormatter:!1,numberDigitGroupCount:3,numberDigitGroupSep:",",numberDecimalMark:".",disableTooltips:!1,disableInteraction:!1},line:{spotColor:"#f80",highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:f,normalRangeMax:f,normalRangeColor:"#ccc",drawNormalOnTop:!1,chartRangeMin:f,chartRangeMax:f,chartRangeMinX:f,chartRangeMaxX:f,tooltipFormat:new ao('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{y}}{{suffix}}')},bar:{barColor:"#3366cc",negBarColor:"#f44",stackedBarColor:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],zeroColor:f,nullColor:f,zeroAxis:!0,barWidth:4,barSpacing:1,chartRangeMax:f,chartRangeMin:f,chartRangeClip:!1,colorMap:f,tooltipFormat:new ao('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{value}}{{suffix}}')},tristate:{barWidth:4,barSpacing:1,posBarColor:"#6f6",negBarColor:"#f44",zeroBarColor:"#999",colorMap:{},tooltipFormat:new ao('<span style="color: {{color}}">&#9679;</span> {{value:map}}'),tooltipValueLookups:{map:{"-1":"Loss",0:"Draw",1:"Win"}}},discrete:{lineHeight:"auto",thresholdColor:f,thresholdValue:0,chartRangeMax:f,chartRangeMin:f,chartRangeClip:!1,tooltipFormat:new ao("{{prefix}}{{value}}{{suffix}}")},bullet:{targetColor:"#f33",targetWidth:3,performanceColor:"#33f",rangeColors:["#d3dafe","#a8b6ff","#7f94ff"],base:f,tooltipFormat:new ao("{{fieldkey:fields}} - {{value}}"),tooltipValueLookups:{fields:{r:"Range",p:"Performance",t:"Target"}}},pie:{offset:0,sliceColors:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],borderWidth:0,borderColor:"#000",tooltipFormat:new ao('<span style="color: {{color}}">&#9679;</span> {{value}} ({{percent.1}}%)')},box:{raw:!1,boxLineColor:"#000",boxFillColor:"#cdf",whiskerColor:"#000",outlierLineColor:"#333",outlierFillColor:"#fff",medianColor:"#f00",showOutliers:!0,outlierIQR:1.5,spotRadius:1.5,target:f,targetColor:"#4a2",chartRangeMax:f,chartRangeMin:f,tooltipFormat:new ao("{{field:fields}}: {{value}}"),tooltipFormatFieldlistKey:"field",tooltipValueLookups:{fields:{lq:"Lower Quartile",med:"Median",uq:"Upper Quartile",lo:"Left Outlier",ro:"Right Outlier",lw:"Left Whisker",rw:"Right Whisker"}}}}},Y='.jqstooltip { position: absolute;left: 0px;top: 0px;visibility: hidden;background: rgb(0, 0, 0) transparent;background-color: rgba(0,0,0,0.6);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000);-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000)";color: white;font: 10px arial, san serif;text-align: left;white-space: nowrap;padding: 5px;border: 1px solid white;z-index: 10000;}.jqsfield { color: white;font: 10px arial, san serif;text-align: left;}',ap=function(){var h,g;return h=function(){this.init.apply(this,arguments)},arguments.length>1?(arguments[0]?(h.prototype=ar.extend(new arguments[0],arguments[arguments.length-1]),h._super=arguments[0].prototype):h.prototype=arguments[arguments.length-1],arguments.length>2&&(g=Array.prototype.slice.call(arguments,1,-1),g.unshift(h.prototype),ar.extend.apply(ar,g))):h.prototype=arguments[0],h.prototype.cls=h,h},ar.SPFormatClass=ao=ap({fre:/\{\{([\w.]+?)(:(.+?))?\}\}/g,precre:/(\w+)\.(\d+)/,init:function(h,g){this.format=h,this.fclass=g},render:function(u,t,s){var r,q,p,o,n,m=this,l=u;return this.format.replace(this.fre,function(){var g;return q=arguments[1],p=arguments[3],r=m.precre.exec(q),r?(n=r[2],q=r[1]):n=!1,o=l[q],o===f?"":p&&t&&t[p]?(g=t[p],g.get?t[p].get(o)||o:t[p][o]||o):(ai(o)&&(o=s.get("numberFormatter")?s.get("numberFormatter")(o):ab(o,n,s.get("numberDigitGroupCount"),s.get("numberDigitGroupSep"),s.get("numberDecimalMark"))),o)})}}),ar.spformat=function(h,g){return new ao(h,g)},an=function(h,g,i){return g>h?g:h>i?i:h},am=function(g,i){var h;return 2===i?(h=d.floor(g.length/2),g.length%2?g[h]:(g[h-1]+g[h])/2):g.length%2?(h=(g.length*i+i)/4,h%1?(g[d.floor(h)]+g[d.floor(h)-1])/2:g[h-1]):(h=(g.length*i+2)/4,h%1?(g[d.floor(h)]+g[d.floor(h)-1])/2:g[h-1])},al=function(h){var g;switch(h){case"undefined":h=f;break;case"null":h=null;break;case"true":h=!0;break;case"false":h=!1;break;default:g=parseFloat(h),h==g&&(h=g)}return h},ak=function(h){var g,i=[];for(g=h.length;g--;){i[g]=al(h[g])}return i},aj=function(h,g){var k,j,i=[];for(k=0,j=h.length;j>k;k++){h[k]!==g&&i.push(h[k])}return i},ai=function(g){return !isNaN(parseFloat(g))&&isFinite(g)},ab=function(j,i,o,n,m){var l,k;for(j=(i===!1?parseFloat(j).toString():j.toFixed(i)).split(""),l=(l=ar.inArray(".",j))<0?j.length:l,l<j.length&&(j[l]=m),k=l-o;k>0;k-=o){j.splice(k,0,n)}return j.join("")},ah=function(h,g,j){var i;for(i=g.length;i--;){if((!j||null!==g[i])&&g[i]!==h){return !1}}return !0},ag=function(h){var g,i=0;for(g=h.length;g--;){i+="number"==typeof h[g]?h[g]:0}return i},ad=function(g){return ar.isArray(g)?g:[g]},af=function(g){var h;e.createStyleSheet?e.createStyleSheet().cssText=g:(h=e.createElement("style"),h.type="text/css",e.getElementsByTagName("head")[0].appendChild(h),h["string"==typeof e.body.style.WebkitAppearance?"innerText":"innerHTML"]=g)},ar.fn.simpledraw=function(k,q,p,o){var n,m;if(p&&(n=this.data("_jqs_vcanvas"))){return n}if(ar.fn.sparkline.canvas===!1){return !1}if(ar.fn.sparkline.canvas===f){var l=e.createElement("canvas");if(l.getContext&&l.getContext("2d")){ar.fn.sparkline.canvas=function(h,g,j,i){return new Q(h,g,j,i)}}else{if(!e.namespaces||e.namespaces.v){return ar.fn.sparkline.canvas=!1,!1}e.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"),ar.fn.sparkline.canvas=function(h,g,i){return new O(h,g,i)}}}return k===f&&(k=ar(this).innerWidth()),q===f&&(q=ar(this).innerHeight()),n=ar.fn.sparkline.canvas(k,q,this,o),m=ar(this).data("_jqs_mhandler"),m&&m.registerCanvas(n),n},ar.fn.cleardraw=function(){var g=this.data("_jqs_vcanvas");g&&g.reset()},ar.RangeMapClass=Z=ap({init:function(h){var g,j,i=[];for(g in h){h.hasOwnProperty(g)&&"string"==typeof g&&g.indexOf(":")>-1&&(j=g.split(":"),j[0]=0===j[0].length?-1/0:parseFloat(j[0]),j[1]=0===j[1].length?1/0:parseFloat(j[1]),j[2]=h[g],i.push(j))}this.map=h,this.rangelist=i||!1},get:function(h){var g,k,j,i=this.rangelist;if((j=this.map[h])!==f){return j}if(i){for(g=i.length;g--;){if(k=i[g],k[0]<=h&&k[1]>=h){return k[2]}}}return f}}),ar.range_map=function(g){return new Z(g)},X=ap({init:function(h,g){var i=ar(h);this.$el=i,this.options=g,this.currentPageX=0,this.currentPageY=0,this.el=h,this.splist=[],this.tooltip=null,this.over=!1,this.displayTooltips=!g.get("disableTooltips"),this.highlightEnabled=!g.get("disableHighlight")},registerSparkline:function(g){this.splist.push(g),this.over&&this.updateDisplay()},registerCanvas:function(h){var g=ar(h.canvas);this.canvas=h,this.$canvas=g,g.mouseenter(ar.proxy(this.mouseenter,this)),g.mouseleave(ar.proxy(this.mouseleave,this)),g.click(ar.proxy(this.mouseclick,this))},reset:function(g){this.splist=[],this.tooltip&&g&&(this.tooltip.remove(),this.tooltip=f)},mouseclick:function(h){var g=ar.Event("sparklineClick");g.originalEvent=h,g.sparklines=this.splist,this.$el.trigger(g)},mouseenter:function(g){ar(e.body).unbind("mousemove.jqs"),ar(e.body).bind("mousemove.jqs",ar.proxy(this.mousemove,this)),this.over=!0,this.currentPageX=g.pageX,this.currentPageY=g.pageY,this.currentEl=g.target,!this.tooltip&&this.displayTooltips&&(this.tooltip=new V(this.options),this.tooltip.updatePosition(g.pageX,g.pageY)),this.updateDisplay()},mouseleave:function(){ar(e.body).unbind("mousemove.jqs");var h,l,k=this.splist,j=k.length,i=!1;for(this.over=!1,this.currentEl=null,this.tooltip&&(this.tooltip.remove(),this.tooltip=null),l=0;j>l;l++){h=k[l],h.clearRegionHighlight()&&(i=!0)}i&&this.canvas.render()},mousemove:function(g){this.currentPageX=g.pageX,this.currentPageY=g.pageY,this.currentEl=g.target,this.tooltip&&this.tooltip.updatePosition(g.pageX,g.pageY),this.updateDisplay()},updateDisplay:function(){var w,v,u,t,s,r=this.splist,q=r.length,p=!1,o=this.$canvas.offset(),n=this.currentPageX-o.left,m=this.currentPageY-o.top;if(this.over){for(u=0;q>u;u++){v=r[u],t=v.setRegionHighlight(this.currentEl,n,m),t&&(p=!0)}if(p){if(s=ar.Event("sparklineRegionChange"),s.sparklines=this.splist,this.$el.trigger(s),this.tooltip){for(w="",u=0;q>u;u++){v=r[u],w+=v.getCurrentRegionTooltip()}this.tooltip.setContent(w)}this.disableHighlight||this.canvas.render()}null===t&&this.mouseleave()}}}),V=ap({sizeStyle:"position: static !important;display: block !important;visibility: hidden !important;float: left !important;",init:function(g){var j,i=g.get("tooltipClassname","jqstooltip"),h=this.sizeStyle;this.container=g.get("tooltipContainer")||e.body,this.tooltipOffsetX=g.get("tooltipOffsetX",10),this.tooltipOffsetY=g.get("tooltipOffsetY",12),ar("#jqssizetip").remove(),ar("#jqstooltip").remove(),this.sizetip=ar("<div/>",{id:"jqssizetip",style:h,"class":i}),this.tooltip=ar("<div/>",{id:"jqstooltip","class":i}).appendTo(this.container),j=this.tooltip.offset(),this.offsetLeft=j.left,this.offsetTop=j.top,this.hidden=!0,ar(window).unbind("resize.jqs scroll.jqs"),ar(window).bind("resize.jqs scroll.jqs",ar.proxy(this.updateWindowDims,this)),this.updateWindowDims()},updateWindowDims:function(){this.scrollTop=ar(window).scrollTop(),this.scrollLeft=ar(window).scrollLeft(),this.scrollRight=this.scrollLeft+ar(window).width(),this.updatePosition()},getSize:function(g){this.sizetip.html(g).appendTo(this.container),this.width=this.sizetip.width()+1,this.height=this.sizetip.height(),this.sizetip.remove()},setContent:function(g){return g?(this.getSize(g),this.tooltip.html(g).css({width:this.width,height:this.height,visibility:"visible"}),void (this.hidden&&(this.hidden=!1,this.updatePosition()))):(this.tooltip.css("visibility","hidden"),void (this.hidden=!0))},updatePosition:function(h,g){if(h===f){if(this.mousex===f){return}h=this.mousex-this.offsetLeft,g=this.mousey-this.offsetTop}else{this.mousex=h-=this.offsetLeft,this.mousey=g-=this.offsetTop}this.height&&this.width&&!this.hidden&&(g-=this.height+this.tooltipOffsetY,h+=this.tooltipOffsetX,g<this.scrollTop&&(g=this.scrollTop),h<this.scrollLeft?h=this.scrollLeft:h+this.width>this.scrollRight&&(h=this.scrollRight-this.width),this.tooltip.css({left:h,top:g}))},remove:function(){this.tooltip.remove(),this.sizetip.remove(),this.sizetip=this.tooltip=f,ar(window).unbind("resize.jqs scroll.jqs")}}),W=function(){af(Y)},ar(W),M=[],ar.fn.sparkline=function(g,h){return this.each(function(){var m,l,k=new ar.fn.sparkline.options(this,h),j=ar(this);if(m=function(){var s,r,q,p,o,n,i;return"html"===g||g===f?(i=this.getAttribute(k.get("tagValuesAttribute")),(i===f||null===i)&&(i=j.html()),s=i.replace(/(^\s*<!--)|(-->\s*$)|\s+/g,"").split(",")):s=g,r="auto"===k.get("width")?s.length*k.get("defaultPixelsPerValue"):k.get("width"),"auto"===k.get("height")?k.get("composite")&&ar.data(this,"_jqs_vcanvas")||(p=e.createElement("span"),p.innerHTML="a",j.html(p),q=ar(p).innerHeight()||ar(p).height(),ar(p).remove(),p=null):q=k.get("height"),k.get("disableInteraction")?o=!1:(o=ar.data(this,"_jqs_mhandler"),o?k.get("composite")||o.reset():(o=new X(this,k),ar.data(this,"_jqs_mhandler",o))),k.get("composite")&&!ar.data(this,"_jqs_vcanvas")?void (ar.data(this,"_jqs_errnotify")||(alert("Attempted to attach a composite sparkline to an element with no existing sparkline"),ar.data(this,"_jqs_errnotify",!0))):(n=new (ar.fn.sparkline[k.get("type")])(this,s,k,r,q),n.render(),void (o&&o.registerSparkline(n)))},ar(this).html()&&!k.get("disableHiddenCheck")&&ar(this).is(":hidden")||!ar(this).parents("body").length){if(!k.get("composite")&&ar.data(this,"_jqs_pending")){for(l=M.length;l;l--){M[l-1][0]==this&&M.splice(l-1,1)}}M.push([this,m]),ar.data(this,"_jqs_pending",!0)}else{m.call(this)}})},ar.fn.sparkline.defaults=aq(),ar.sparkline_display_visible=function(){var h,g,j,i=[];for(g=0,j=M.length;j>g;g++){h=M[g][0],ar(h).is(":visible")&&!ar(h).parents().is(":hidden")?(M[g][1].call(h),ar.data(M[g][0],"_jqs_pending",!1),i.push(g)):ar(h).closest("html").length||ar.data(h,"_jqs_pending")||(ar.data(M[g][0],"_jqs_pending",!1),i.push(g))}for(g=i.length;g;g--){M.splice(i[g-1],1)}},ar.fn.sparkline.options=ap({init:function(i,h){var m,l,k,j;this.userOptions=h=h||{},this.tag=i,this.tagValCache={},l=ar.fn.sparkline.defaults,k=l.common,this.tagOptionsPrefix=h.enableTagOptions&&(h.tagOptionsPrefix||k.tagOptionsPrefix),j=this.getTagSetting("type"),m=j===b?l[h.type||k.type]:l[j],this.mergedOptions=ar.extend({},k,m,h)},getTagSetting:function(i){var h,m,l,k,j=this.tagOptionsPrefix;if(j===!1||j===f){return b}if(this.tagValCache.hasOwnProperty(i)){h=this.tagValCache.key}else{if(h=this.tag.getAttribute(j+i),h===f||null===h){h=b}else{if("["===h.substr(0,1)){for(h=h.substr(1,h.length-2).split(","),m=h.length;m--;){h[m]=al(h[m].replace(/(^\s*)|(\s*$)/g,""))}}else{if("{"===h.substr(0,1)){for(l=h.substr(1,h.length-2).split(","),h={},m=l.length;m--;){k=l[m].split(":",2),h[k[0].replace(/(^\s*)|(\s*$)/g,"")]=al(k[1].replace(/(^\s*)|(\s*$)/g,""))}}else{h=al(h)}}}this.tagValCache.key=h}return h},get:function(h,g){var j,i=this.getTagSetting(h);return i!==b?i:(j=this.mergedOptions[h])===f?g:j}}),ar.fn.sparkline._base=ap({disabled:!1,init:function(i,h,l,k,j){this.el=i,this.$el=ar(i),this.values=h,this.options=l,this.width=k,this.height=j,this.currentRegion=f},initTarget:function(){var g=!this.options.get("disableInteraction");(this.target=this.$el.simpledraw(this.width,this.height,this.options.get("composite"),g))?(this.canvasWidth=this.target.pixelWidth,this.canvasHeight=this.target.pixelHeight):this.disabled=!0},render:function(){return this.disabled?(this.el.innerHTML="",!1):!0},getRegion:function(){},setRegionHighlight:function(i,h,m){var l,k=this.currentRegion,j=!this.options.get("disableHighlight");return h>this.canvasWidth||m>this.canvasHeight||0>h||0>m?null:(l=this.getRegion(i,h,m),k!==l?(k!==f&&j&&this.removeHighlight(),this.currentRegion=l,l!==f&&j&&this.renderHighlight(),!0):!1)},clearRegionHighlight:function(){return this.currentRegion!==f?(this.removeHighlight(),this.currentRegion=f,!0):!1},renderHighlight:function(){this.changeHighlight(!0)},removeHighlight:function(){this.changeHighlight(!1)},changeHighlight:function(){},getCurrentRegionTooltip:function(){var H,G,F,E,D,C,B,A,z,y,x,w,v,u,g=this.options,J="",I=[];if(this.currentRegion===f){return""}if(H=this.getCurrentRegionFields(),x=g.get("tooltipFormatter")){return x(this,g,H)}if(g.get("tooltipChartTitle")&&(J+='<div class="jqs jqstitle">'+g.get("tooltipChartTitle")+"</div>\n"),G=this.options.get("tooltipFormat"),!G){return""}if(ar.isArray(G)||(G=[G]),ar.isArray(H)||(H=[H]),B=this.options.get("tooltipFormatFieldlist"),A=this.options.get("tooltipFormatFieldlistKey"),B&&A){for(z=[],C=H.length;C--;){y=H[C][A],-1!=(u=ar.inArray(y,B))&&(z[u]=H[C])}H=z}for(F=G.length,v=H.length,C=0;F>C;C++){for(w=G[C],"string"==typeof w&&(w=new ao(w)),E=w.fclass||"jqsfield",u=0;v>u;u++){H[u].isNull&&g.get("tooltipSkipNull")||(ar.extend(H[u],{prefix:g.get("tooltipPrefix"),suffix:g.get("tooltipSuffix")}),D=w.render(H[u],g.get("tooltipValueLookups"),g),I.push('<div class="'+E+'">'+D+"</div>"))}}return I.length?J+I.join("\n"):""},getCurrentRegionFields:function(){},calcHighlightColor:function(h,q){var p,o,n,m,l=q.get("highlightColor"),k=q.get("highlightLighten");if(l){return l}if(k&&(p=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(h)||/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(h))){for(n=[],o=4===h.length?16:1,m=0;3>m;m++){n[m]=an(d.round(parseInt(p[m+1],16)*o*k),0,255)}return"rgb("+n.join(",")+")"}return h}}),T={changeHighlight:function(h){var g,k=this.currentRegion,j=this.target,i=this.regionShapes[k];i&&(g=this.renderRegion(k,h),ar.isArray(g)||ar.isArray(i)?(j.replaceWithShapes(i,g),this.regionShapes[k]=ar.map(g,function(l){return l.id})):(j.replaceWithShape(i,g),this.regionShapes[k]=g.id))},render:function(){var j,i,o,n,m=this.values,l=this.target,k=this.regionShapes;if(this.cls._super.render.call(this)){for(o=m.length;o--;){if(j=this.renderRegion(o)){if(ar.isArray(j)){for(i=[],n=j.length;n--;){j[n].append(),i.push(j[n].id)}k[o]=i}else{j.append(),k[o]=j.id}}else{k[o]=null}}l.render()}}},ar.fn.sparkline.line=R=ap(ar.fn.sparkline._base,{type:"line",init:function(h,g,k,j,i){R._super.init.call(this,h,g,k,j,i),this.vertices=[],this.regionMap=[],this.xvalues=[],this.yvalues=[],this.yminmax=[],this.hightlightSpotId=null,this.lastShapeId=null,this.initTarget()},getRegion:function(h,g){var j,i=this.regionMap;for(j=i.length;j--;){if(null!==i[j]&&g>=i[j][0]&&g<=i[j][1]){return i[j][2]}}return f},getCurrentRegionFields:function(){var g=this.currentRegion;return{isNull:null===this.yvalues[g],x:this.xvalues[g],y:this.yvalues[g],color:this.options.get("lineColor"),fillColor:this.options.get("fillColor"),offset:g}},renderHighlight:function(){var s,r,q=this.currentRegion,p=this.target,o=this.vertices[q],n=this.options,m=n.get("spotRadius"),l=n.get("highlightSpotColor"),k=n.get("highlightLineColor");o&&(m&&l&&(s=p.drawCircle(o[0],o[1],m,f,l),this.highlightSpotId=s.id,p.insertAfterShape(this.lastShapeId,s)),k&&(r=p.drawLine(o[0],this.canvasTop,o[0],this.canvasTop+this.canvasHeight,k),this.highlightLineId=r.id,p.insertAfterShape(this.lastShapeId,r)))},removeHighlight:function(){var g=this.target;this.highlightSpotId&&(g.removeShapeId(this.highlightSpotId),this.highlightSpotId=null),this.highlightLineId&&(g.removeShapeId(this.highlightLineId),this.highlightLineId=null)},scanValues:function(){var u,t,s,r,q,p=this.values,o=p.length,n=this.xvalues,m=this.yvalues,l=this.yminmax;for(u=0;o>u;u++){t=p[u],s="string"==typeof p[u],r="object"==typeof p[u]&&p[u] instanceof Array,q=s&&p[u].split(":"),s&&2===q.length?(n.push(Number(q[0])),m.push(Number(q[1])),l.push(Number(q[1]))):r?(n.push(t[0]),m.push(t[1]),l.push(t[1])):(n.push(u),null===p[u]||"null"===p[u]?m.push(null):(m.push(Number(t)),l.push(Number(t))))}this.options.get("xvalues")&&(n=this.options.get("xvalues")),this.maxy=this.maxyorg=d.max.apply(d,l),this.miny=this.minyorg=d.min.apply(d,l),this.maxx=d.max.apply(d,n),this.minx=d.min.apply(d,n),this.xvalues=n,this.yvalues=m,this.yminmax=l},processRangeOptions:function(){var h=this.options,g=h.get("normalRangeMin"),i=h.get("normalRangeMax");g!==f&&(g<this.miny&&(this.miny=g),i>this.maxy&&(this.maxy=i)),h.get("chartRangeMin")!==f&&(h.get("chartRangeClip")||h.get("chartRangeMin")<this.miny)&&(this.miny=h.get("chartRangeMin")),h.get("chartRangeMax")!==f&&(h.get("chartRangeClip")||h.get("chartRangeMax")>this.maxy)&&(this.maxy=h.get("chartRangeMax")),h.get("chartRangeMinX")!==f&&(h.get("chartRangeClipX")||h.get("chartRangeMinX")<this.minx)&&(this.minx=h.get("chartRangeMinX")),h.get("chartRangeMaxX")!==f&&(h.get("chartRangeClipX")||h.get("chartRangeMaxX")>this.maxx)&&(this.maxx=h.get("chartRangeMaxX"))},drawNormalRange:function(t,s,r,q,p){var o=this.options.get("normalRangeMin"),n=this.options.get("normalRangeMax"),m=s+d.round(r-r*((n-this.miny)/p)),l=d.round(r*(n-o)/p);this.target.drawRect(t,m,q,l,f,this.options.get("normalRangeColor")).append()},render:function(){var aV,aU,aT,aS,aR,aQ,aP,aO,aN,aM,aL,aK,aJ,aH,aF,aC,aA,ay,av,at,w,aI,aG,aE,aD,aB=this.options,az=this.target,ax=this.canvasWidth,aw=this.canvasHeight,au=this.vertices,L=aB.get("spotRadius"),s=this.regionMap;if(R._super.render.call(this)&&(this.scanValues(),this.processRangeOptions(),aG=this.xvalues,aE=this.yvalues,this.yminmax.length&&!(this.yvalues.length<2))){for(aS=aR=0,aV=this.maxx-this.minx===0?1:this.maxx-this.minx,aU=this.maxy-this.miny===0?1:this.maxy-this.miny,aT=this.yvalues.length-1,L&&(4*L>ax||4*L>aw)&&(L=0),L&&(w=aB.get("highlightSpotColor")&&!aB.get("disableInteraction"),(w||aB.get("minSpotColor")||aB.get("spotColor")&&aE[aT]===this.miny)&&(aw-=d.ceil(L)),(w||aB.get("maxSpotColor")||aB.get("spotColor")&&aE[aT]===this.maxy)&&(aw-=d.ceil(L),aS+=d.ceil(L)),(w||(aB.get("minSpotColor")||aB.get("maxSpotColor"))&&(aE[0]===this.miny||aE[0]===this.maxy))&&(aR+=d.ceil(L),ax-=d.ceil(L)),(w||aB.get("spotColor")||aB.get("minSpotColor")||aB.get("maxSpotColor")&&(aE[aT]===this.miny||aE[aT]===this.maxy))&&(ax-=d.ceil(L))),aw--,aB.get("normalRangeMin")===f||aB.get("drawNormalOnTop")||this.drawNormalRange(aR,aS,aw,ax,aU),aP=[],aO=[aP],aH=aF=null,aC=aE.length,aD=0;aC>aD;aD++){aN=aG[aD],aL=aG[aD+1],aM=aE[aD],aK=aR+d.round((aN-this.minx)*(ax/aV)),aJ=aC-1>aD?aR+d.round((aL-this.minx)*(ax/aV)):ax,aF=aK+(aJ-aK)/2,s[aD]=[aH||0,aF,aD],aH=aF,null===aM?aD&&(null!==aE[aD-1]&&(aP=[],aO.push(aP)),au.push(null)):(aM<this.miny&&(aM=this.miny),aM>this.maxy&&(aM=this.maxy),aP.length||aP.push([aK,aS+aw]),aQ=[aK,aS+d.round(aw-aw*((aM-this.miny)/aU))],aP.push(aQ),au.push(aQ))}for(aA=[],ay=[],av=aO.length,aD=0;av>aD;aD++){aP=aO[aD],aP.length&&(aB.get("fillColor")&&(aP.push([aP[aP.length-1][0],aS+aw]),ay.push(aP.slice(0)),aP.pop()),aP.length>2&&(aP[0]=[aP[0][0],aP[1][1]]),aA.push(aP))}for(av=ay.length,aD=0;av>aD;aD++){az.drawShape(ay[aD],aB.get("fillColor"),aB.get("fillColor")).append()}for(aB.get("normalRangeMin")!==f&&aB.get("drawNormalOnTop")&&this.drawNormalRange(aR,aS,aw,ax,aU),av=aA.length,aD=0;av>aD;aD++){az.drawShape(aA[aD],aB.get("lineColor"),f,aB.get("lineWidth")).append()}if(L&&aB.get("valueSpots")){for(at=aB.get("valueSpots"),at.get===f&&(at=new Z(at)),aD=0;aC>aD;aD++){aI=at.get(aE[aD]),aI&&az.drawCircle(aR+d.round((aG[aD]-this.minx)*(ax/aV)),aS+d.round(aw-aw*((aE[aD]-this.miny)/aU)),L,f,aI).append()}}L&&aB.get("spotColor")&&null!==aE[aT]&&az.drawCircle(aR+d.round((aG[aG.length-1]-this.minx)*(ax/aV)),aS+d.round(aw-aw*((aE[aT]-this.miny)/aU)),L,f,aB.get("spotColor")).append(),this.maxy!==this.minyorg&&(L&&aB.get("minSpotColor")&&(aN=aG[ar.inArray(this.minyorg,aE)],az.drawCircle(aR+d.round((aN-this.minx)*(ax/aV)),aS+d.round(aw-aw*((this.minyorg-this.miny)/aU)),L,f,aB.get("minSpotColor")).append()),L&&aB.get("maxSpotColor")&&(aN=aG[ar.inArray(this.maxyorg,aE)],az.drawCircle(aR+d.round((aN-this.minx)*(ax/aV)),aS+d.round(aw-aw*((this.maxyorg-this.miny)/aU)),L,f,aB.get("maxSpotColor")).append())),this.lastShapeId=az.getLastShapeId(),this.canvasTop=aS,az.render()}}}),ar.fn.sparkline.bar=P=ap(ar.fn.sparkline._base,T,{type:"bar",init:function(aW,aV,aU,aT,aS){var aR,aQ,aP,aO,aN,aM,aL,aK,aJ,aI,aH,aG,aF,aE,aD,aC,aB,aA,az,ay,ax,aw,av=parseInt(aU.get("barWidth"),10),au=parseInt(aU.get("barSpacing"),10),at=aU.get("chartRangeMin"),x=aU.get("chartRangeMax"),s=aU.get("chartRangeClip"),l=1/0,k=-1/0;for(P._super.init.call(this,aW,aV,aU,aT,aS),aM=0,aL=aV.length;aL>aM;aM++){ay=aV[aM],aR="string"==typeof ay&&ay.indexOf(":")>-1,(aR||ar.isArray(ay))&&(aD=!0,aR&&(ay=aV[aM]=ak(ay.split(":"))),ay=aj(ay,null),aQ=d.min.apply(d,ay),aP=d.max.apply(d,ay),l>aQ&&(l=aQ),aP>k&&(k=aP))}this.stacked=aD,this.regionShapes={},this.barWidth=av,this.barSpacing=au,this.totalBarWidth=av+au,this.width=aT=aV.length*av+(aV.length-1)*au,this.initTarget(),s&&(aF=at===f?-1/0:at,aE=x===f?1/0:x),aN=[],aO=aD?[]:aN;var j=[],h=[];for(aM=0,aL=aV.length;aL>aM;aM++){if(aD){for(aC=aV[aM],aV[aM]=az=[],j[aM]=0,aO[aM]=h[aM]=0,aB=0,aA=aC.length;aA>aB;aB++){ay=az[aB]=s?an(aC[aB],aF,aE):aC[aB],null!==ay&&(ay>0&&(j[aM]+=ay),0>l&&k>0?0>ay?h[aM]+=d.abs(ay):aO[aM]+=ay:aO[aM]+=d.abs(ay-(0>ay?k:l)),aN.push(ay))}}else{ay=s?an(aV[aM],aF,aE):aV[aM],ay=aV[aM]=al(ay),null!==ay&&aN.push(ay)}}this.max=aG=d.max.apply(d,aN),this.min=aH=d.min.apply(d,aN),this.stackMax=k=aD?d.max.apply(d,j):aG,this.stackMin=l=aD?d.min.apply(d,aN):aH,aU.get("chartRangeMin")!==f&&(aU.get("chartRangeClip")||aU.get("chartRangeMin")<aH)&&(aH=aU.get("chartRangeMin")),aU.get("chartRangeMax")!==f&&(aU.get("chartRangeClip")||aU.get("chartRangeMax")>aG)&&(aG=aU.get("chartRangeMax")),this.zeroAxis=aJ=aU.get("zeroAxis",!0),aI=0>=aH&&aG>=0&&aJ?0:0==aJ?aH:aH>0?aH:aG,this.xaxisOffset=aI,aK=aD?d.max.apply(d,aO)+d.max.apply(d,h):aG-aH,this.canvasHeightEf=aJ&&0>aH?this.canvasHeight-2:this.canvasHeight-1,aI>aH?(aw=aD&&aG>=0?k:aG,ax=(aw-aI)/aK*this.canvasHeight,ax!==d.ceil(ax)&&(this.canvasHeightEf-=2,ax=d.ceil(ax))):ax=this.canvasHeight,this.yoffset=ax,ar.isArray(aU.get("colorMap"))?(this.colorMapByIndex=aU.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=aU.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===f&&(this.colorMapByValue=new Z(this.colorMapByValue))),this.range=aK},getRegion:function(g,i){var h=d.floor(i/this.totalBarWidth);return 0>h||h>=this.values.length?f:h},getCurrentRegionFields:function(){var h,g,k=this.currentRegion,j=ad(this.values[k]),i=[];for(g=j.length;g--;){h=j[g],i.push({isNull:null===h,value:h,color:this.calcColor(g,h,k),offset:k})}return i},calcColor:function(l,k,r){var q,p,o=this.colorMapByIndex,n=this.colorMapByValue,m=this.options;return q=m.get(this.stacked?"stackedBarColor":0>k?"negBarColor":"barColor"),0===k&&m.get("zeroColor")!==f&&(q=m.get("zeroColor")),n&&(p=n.get(k))?q=p:o&&o.length>r&&(q=o[r]),ar.isArray(q)?q[l%q.length]:q},renderRegion:function(aB,aA){var az,ay,ax,aw,av,au,at,L,K,J,I=this.values[aB],H=this.options,G=this.xaxisOffset,F=[],E=this.range,D=this.stacked,C=this.target,B=aB*this.totalBarWidth,A=this.canvasHeightEf,n=this.yoffset;if(I=ar.isArray(I)?I:[I],at=I.length,L=I[0],aw=ah(null,I),J=ah(G,I,!0),aw){return H.get("nullColor")?(ax=aA?H.get("nullColor"):this.calcHighlightColor(H.get("nullColor"),H),az=n>0?n-1:n,C.drawRect(B,az,this.barWidth-1,0,ax,ax)):f}for(av=n,au=0;at>au;au++){if(L=I[au],D&&L===G){if(!J||K){continue}K=!0}ay=E>0?d.floor(A*(d.abs(L-G)/E))+1:1,G>L||L===G&&0===n?(az=av,av+=ay):(az=n-ay,n-=ay),ax=this.calcColor(au,L,aB),aA&&(ax=this.calcHighlightColor(ax,H)),F.push(C.drawRect(B,az,this.barWidth-1,ay-1,ax,ax))}return 1===F.length?F[0]:F}}),ar.fn.sparkline.tristate=N=ap(ar.fn.sparkline._base,T,{type:"tristate",init:function(k,j,p,o,n){var m=parseInt(p.get("barWidth"),10),l=parseInt(p.get("barSpacing"),10);N._super.init.call(this,k,j,p,o,n),this.regionShapes={},this.barWidth=m,this.barSpacing=l,this.totalBarWidth=m+l,this.values=ar.map(j,Number),this.width=o=j.length*m+(j.length-1)*l,ar.isArray(p.get("colorMap"))?(this.colorMapByIndex=p.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=p.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===f&&(this.colorMapByValue=new Z(this.colorMapByValue))),this.initTarget()},getRegion:function(g,h){return d.floor(h/this.totalBarWidth)},getCurrentRegionFields:function(){var g=this.currentRegion;return{isNull:this.values[g]===f,value:this.values[g],color:this.calcColor(this.values[g],g),offset:g}},calcColor:function(j,i){var p,o,n=this.values,m=this.options,l=this.colorMapByIndex,k=this.colorMapByValue;return p=k&&(o=k.get(j))?o:l&&l.length>i?l[i]:m.get(n[i]<0?"negBarColor":n[i]>0?"posBarColor":"zeroBarColor")},renderRegion:function(w,v){var u,t,s,r,q,p,o=this.values,n=this.options,m=this.target;return u=m.pixelHeight,s=d.round(u/2),r=w*this.totalBarWidth,o[w]<0?(q=s,t=s-1):o[w]>0?(q=0,t=s-1):(q=s-1,t=2),p=this.calcColor(o[w],w),null!==p?(v&&(p=this.calcHighlightColor(p,n)),m.drawRect(r,q,this.barWidth-1,t-1,p,p)):void 0}}),ar.fn.sparkline.discrete=c=ap(ar.fn.sparkline._base,T,{type:"discrete",init:function(i,m,l,k,j){c._super.init.call(this,i,m,l,k,j),this.regionShapes={},this.values=m=ar.map(m,Number),this.min=d.min.apply(d,m),this.max=d.max.apply(d,m),this.range=this.max-this.min,this.width=k="auto"===l.get("width")?2*m.length:this.width,this.interval=d.floor(k/m.length),this.itemWidth=k/m.length,l.get("chartRangeMin")!==f&&(l.get("chartRangeClip")||l.get("chartRangeMin")<this.min)&&(this.min=l.get("chartRangeMin")),l.get("chartRangeMax")!==f&&(l.get("chartRangeClip")||l.get("chartRangeMax")>this.max)&&(this.max=l.get("chartRangeMax")),this.initTarget(),this.target&&(this.lineHeight="auto"===l.get("lineHeight")?d.round(0.3*this.canvasHeight):l.get("lineHeight"))},getRegion:function(g,h){return d.floor(h/this.itemWidth)},getCurrentRegionFields:function(){var g=this.currentRegion;return{isNull:this.values[g]===f,value:this.values[g],offset:g}},renderRegion:function(G,F){var E,D,C,B,A=this.values,z=this.options,y=this.min,x=this.max,w=this.range,v=this.interval,u=this.target,t=this.canvasHeight,s=this.lineHeight,h=t-s;return D=an(A[G],y,x),B=G*v,E=d.round(h-h*((D-y)/w)),C=z.get(z.get("thresholdColor")&&D<z.get("thresholdValue")?"thresholdColor":"lineColor"),F&&(C=this.calcHighlightColor(C,z)),u.drawLine(B,E,B,E+s,C)}}),ar.fn.sparkline.bullet=ae=ap(ar.fn.sparkline._base,{type:"bullet",init:function(k,r,q,p,o){var n,m,l;ae._super.init.call(this,k,r,q,p,o),this.values=r=ak(r),l=r.slice(),l[0]=null===l[0]?l[2]:l[0],l[1]=null===r[1]?l[2]:l[1],n=d.min.apply(d,r),m=d.max.apply(d,r),n=q.get("base")===f?0>n?n:0:q.get("base"),this.min=n,this.max=m,this.range=m-n,this.shapes={},this.valueShapes={},this.regiondata={},this.width=p="auto"===q.get("width")?"4.0em":p,this.target=this.$el.simpledraw(p,o,q.get("composite")),r.length||(this.disabled=!0),this.initTarget()},getRegion:function(h,g,j){var i=this.target.getShapeAt(h,g,j);return i!==f&&this.shapes[i]!==f?this.shapes[i]:f},getCurrentRegionFields:function(){var g=this.currentRegion;return{fieldkey:g.substr(0,1),value:this.values[g.substr(1)],region:g}},changeHighlight:function(h){var g,j=this.currentRegion,i=this.valueShapes[j];switch(delete this.shapes[i],j.substr(0,1)){case"r":g=this.renderRange(j.substr(1),h);break;case"p":g=this.renderPerformance(h);break;case"t":g=this.renderTarget(h)}this.valueShapes[j]=g.id,this.shapes[g.id]=j,this.target.replaceWithShape(i,g)},renderRange:function(g,k){var j=this.values[g],i=d.round(this.canvasWidth*((j-this.min)/this.range)),h=this.options.get("rangeColors")[g-2];return k&&(h=this.calcHighlightColor(h,this.options)),this.target.drawRect(0,0,i-1,this.canvasHeight-1,h,h)},renderPerformance:function(g){var j=this.values[1],i=d.round(this.canvasWidth*((j-this.min)/this.range)),h=this.options.get("performanceColor");return g&&(h=this.calcHighlightColor(h,this.options)),this.target.drawRect(0,d.round(0.3*this.canvasHeight),i-1,d.round(0.4*this.canvasHeight)-1,h,h)},renderTarget:function(h){var m=this.values[0],l=d.round(this.canvasWidth*((m-this.min)/this.range)-this.options.get("targetWidth")/2),k=d.round(0.1*this.canvasHeight),j=this.canvasHeight-2*k,i=this.options.get("targetColor");return h&&(i=this.calcHighlightColor(i,this.options)),this.target.drawRect(l,k,this.options.get("targetWidth")-1,j-1,i,i)},render:function(){var h,g,j=this.values.length,i=this.target;if(ae._super.render.call(this)){for(h=2;j>h;h++){g=this.renderRange(h).append(),this.shapes[g.id]="r"+h,this.valueShapes["r"+h]=g.id}null!==this.values[1]&&(g=this.renderPerformance().append(),this.shapes[g.id]="p1",this.valueShapes.p1=g.id),null!==this.values[0]&&(g=this.renderTarget().append(),this.shapes[g.id]="t0",this.valueShapes.t0=g.id),i.render()}}}),ar.fn.sparkline.pie=ac=ap(ar.fn.sparkline._base,{type:"pie",init:function(j,p,o,n,m){var l,k=0;if(ac._super.init.call(this,j,p,o,n,m),this.shapes={},this.valueShapes={},this.values=p=ar.map(p,Number),"auto"===o.get("width")&&(this.width=this.height),p.length>0){for(l=p.length;l--;){k+=p[l]}}this.total=k,this.initTarget(),this.radius=d.floor(d.min(this.canvasWidth,this.canvasHeight)/2)},getRegion:function(h,g,j){var i=this.target.getShapeAt(h,g,j);return i!==f&&this.shapes[i]!==f?this.shapes[i]:f},getCurrentRegionFields:function(){var g=this.currentRegion;return{isNull:this.values[g]===f,value:this.values[g],percent:this.values[g]/this.total*100,color:this.options.get("sliceColors")[g%this.options.get("sliceColors").length],offset:g}},changeHighlight:function(h){var g=this.currentRegion,j=this.renderSlice(g,h),i=this.valueShapes[g];delete this.shapes[i],this.target.replaceWithShape(i,j),this.valueShapes[g]=j.id,this.shapes[j.id]=g},renderSlice:function(H,G){var F,E,D,C,B,A=this.target,z=this.options,y=this.radius,x=z.get("borderWidth"),w=z.get("offset"),v=2*d.PI,u=this.values,t=this.total,s=w?2*d.PI*(w/360):0;for(C=u.length,D=0;C>D;D++){if(F=s,E=s,t>0&&(E=s+v*(u[D]/t)),H===D){return B=z.get("sliceColors")[D%z.get("sliceColors").length],G&&(B=this.calcHighlightColor(B,z)),A.drawPieSlice(y,y,y-x,F,E,f,B)}s=E}},render:function(){var j,p,o=this.target,n=this.values,m=this.options,l=this.radius,k=m.get("borderWidth");if(ac._super.render.call(this)){for(k&&o.drawCircle(l,l,d.floor(l-k/2),m.get("borderColor"),f,k).append(),p=n.length;p--;){n[p]&&(j=this.renderSlice(p).append(),this.valueShapes[p]=j.id,this.shapes[j.id]=p)}o.render()}}}),ar.fn.sparkline.box=aa=ap(ar.fn.sparkline._base,{type:"box",init:function(h,g,k,j,i){aa._super.init.call(this,h,g,k,j,i),this.values=ar.map(g,Number),this.width="auto"===k.get("width")?"4.0em":j,this.initTarget(),this.values.length||(this.disabled=1)},getRegion:function(){return 1},getCurrentRegionFields:function(){var g=[{field:"lq",value:this.quartiles[0]},{field:"med",value:this.quartiles[1]},{field:"uq",value:this.quartiles[2]}];return this.loutlier!==f&&g.push({field:"lo",value:this.loutlier}),this.routlier!==f&&g.push({field:"ro",value:this.routlier}),this.lwhisker!==f&&g.push({field:"lw",value:this.lwhisker}),this.rwhisker!==f&&g.push({field:"rw",value:this.rwhisker}),g},render:function(){var aw,av,au,at,L,K,J,I,H,G,F,E=this.target,D=this.values,C=D.length,B=this.options,A=this.canvasWidth,z=this.canvasHeight,y=B.get("chartRangeMin")===f?d.min.apply(d,D):B.get("chartRangeMin"),x=B.get("chartRangeMax")===f?d.max.apply(d,D):B.get("chartRangeMax"),i=0;if(aa._super.render.call(this)){if(B.get("raw")){B.get("showOutliers")&&D.length>5?(av=D[0],aw=D[1],at=D[2],L=D[3],K=D[4],J=D[5],I=D[6]):(aw=D[0],at=D[1],L=D[2],K=D[3],J=D[4])}else{if(D.sort(function(h,g){return h-g}),at=am(D,1),L=am(D,2),K=am(D,3),au=K-at,B.get("showOutliers")){for(aw=J=f,H=0;C>H;H++){aw===f&&D[H]>at-au*B.get("outlierIQR")&&(aw=D[H]),D[H]<K+au*B.get("outlierIQR")&&(J=D[H])}av=D[0],I=D[C-1]}else{aw=D[0],J=D[C-1]}}this.quartiles=[at,L,K],this.lwhisker=aw,this.rwhisker=J,this.loutlier=av,this.routlier=I,F=A/(x-y+1),B.get("showOutliers")&&(i=d.ceil(B.get("spotRadius")),A-=2*d.ceil(B.get("spotRadius")),F=A/(x-y+1),aw>av&&E.drawCircle((av-y)*F+i,z/2,B.get("spotRadius"),B.get("outlierLineColor"),B.get("outlierFillColor")).append(),I>J&&E.drawCircle((I-y)*F+i,z/2,B.get("spotRadius"),B.get("outlierLineColor"),B.get("outlierFillColor")).append()),E.drawRect(d.round((at-y)*F+i),d.round(0.1*z),d.round((K-at)*F),d.round(0.8*z),B.get("boxLineColor"),B.get("boxFillColor")).append(),E.drawLine(d.round((aw-y)*F+i),d.round(z/2),d.round((at-y)*F+i),d.round(z/2),B.get("lineColor")).append(),E.drawLine(d.round((aw-y)*F+i),d.round(z/4),d.round((aw-y)*F+i),d.round(z-z/4),B.get("whiskerColor")).append(),E.drawLine(d.round((J-y)*F+i),d.round(z/2),d.round((K-y)*F+i),d.round(z/2),B.get("lineColor")).append(),E.drawLine(d.round((J-y)*F+i),d.round(z/4),d.round((J-y)*F+i),d.round(z-z/4),B.get("whiskerColor")).append(),E.drawLine(d.round((L-y)*F+i),d.round(0.1*z),d.round((L-y)*F+i),d.round(0.9*z),B.get("medianColor")).append(),B.get("target")&&(G=d.ceil(B.get("spotRadius")),E.drawLine(d.round((B.get("target")-y)*F+i),d.round(z/2-G),d.round((B.get("target")-y)*F+i),d.round(z/2+G),B.get("targetColor")).append(),E.drawLine(d.round((B.get("target")-y)*F+i-G),d.round(z/2),d.round((B.get("target")-y)*F+i+G),d.round(z/2),B.get("targetColor")).append()),E.render()}}}),U=ap({init:function(h,g,j,i){this.target=h,this.id=g,this.type=j,this.args=i},append:function(){return this.target.appendShape(this),this}}),S=ap({_pxregex:/(\d+)(px)?\s*$/i,init:function(h,g,i){h&&(this.width=h,this.height=g,this.target=i,this.lastShapeId=null,i[0]&&(i=i[0]),ar.data(i,"_jqs_vcanvas",this))},drawLine:function(h,g,l,k,j,i){return this.drawShape([[h,g],[l,k]],j,i)},drawShape:function(h,g,j,i){return this._genShape("Shape",[h,g,j,i])},drawCircle:function(h,g,l,k,j,i){return this._genShape("Circle",[h,g,l,k,j,i])},drawPieSlice:function(i,h,n,m,l,k,j){return this._genShape("PieSlice",[i,h,n,m,l,k,j])},drawRect:function(h,g,l,k,j,i){return this._genShape("Rect",[h,g,l,k,j,i])},getElement:function(){return this.canvas},getLastShapeId:function(){return this.lastShapeId},reset:function(){alert("reset not implemented")},_insert:function(h,g){ar(g).html(h)},_calculatePixelDims:function(h,g,j){var i;i=this._pxregex.exec(g),this.pixelHeight=i?i[1]:ar(j).height(),i=this._pxregex.exec(h),this.pixelWidth=i?i[1]:ar(j).width()},_genShape:function(h,g){var i=a++;return g.unshift(i),new U(this,i,h,g)},appendShape:function(){alert("appendShape not implemented")},replaceWithShape:function(){alert("replaceWithShape not implemented")},insertAfterShape:function(){alert("insertAfterShape not implemented")},removeShapeId:function(){alert("removeShapeId not implemented")},getShapeAt:function(){alert("getShapeAt not implemented")},render:function(){alert("render not implemented")}}),Q=ap(S,{init:function(k,q,p,o){Q._super.init.call(this,k,q,p),this.canvas=e.createElement("canvas"),p[0]&&(p=p[0]),this.context=this.canvas.getContext("2d");var n=window.devicePixelRatio||1,m=this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1,l=n/m;ar.data(p,"_jqs_vcanvas",this),ar(this.canvas).css({display:"inline-block",width:k,height:q,verticalAlign:"top"}),this._insert(this.canvas,p),this._calculatePixelDims(k,q,this.canvas),this.canvas.width=this.pixelWidth*l,this.canvas.height=this.pixelHeight*l,this.context.scale(l,l),this.interact=o,this.shapes={},this.shapeseq=[],this.currentTargetShapeId=f,ar(this.canvas).css({width:this.pixelWidth,height:this.pixelHeight})},_getContext:function(h,g,j){var i=this.canvas.getContext("2d");return h!==f&&(i.strokeStyle=h),i.lineWidth=j===f?1:j,g!==f&&(i.fillStyle=g),i},reset:function(){var g=this._getContext();g.clearRect(0,0,this.pixelWidth,this.pixelHeight),this.shapes={},this.shapeseq=[],this.currentTargetShapeId=f},_drawShape:function(k,j,q,p,o){var n,m,l=this._getContext(q,p,o);for(l.beginPath(),l.moveTo(j[0][0]+0.5,j[0][1]+0.5),n=1,m=j.length;m>n;n++){l.lineTo(j[n][0]+0.5,j[n][1]+0.5)}q!==f&&l.stroke(),p!==f&&l.fill(),this.targetX!==f&&this.targetY!==f&&l.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=k)},_drawCircle:function(k,r,q,p,o,n,m){var l=this._getContext(o,n,m);l.beginPath(),l.arc(r,q,p,0,2*d.PI,!1),this.targetX!==f&&this.targetY!==f&&l.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=k),o!==f&&l.stroke(),n!==f&&l.fill()},_drawPieSlice:function(s,r,q,p,o,n,m,l){var k=this._getContext(m,l);k.beginPath(),k.moveTo(r,q),k.arc(r,q,p,o,n,!1),k.lineTo(r,q),k.closePath(),m!==f&&k.stroke(),l&&k.fill(),this.targetX!==f&&this.targetY!==f&&k.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=s)},_drawRect:function(i,h,n,m,l,k,j){return this._drawShape(i,[[h,n],[h+m,n],[h+m,n+l],[h,n+l],[h,n]],k,j)},appendShape:function(g){return this.shapes[g.id]=g,this.shapeseq.push(g.id),this.lastShapeId=g.id,g.id},replaceWithShape:function(h,g){var j,i=this.shapeseq;for(this.shapes[g.id]=g,j=i.length;j--;){i[j]==h&&(i[j]=g.id)}delete this.shapes[h]},replaceWithShapes:function(i,h){var n,m,l,k=this.shapeseq,j={};for(m=i.length;m--;){j[i[m]]=!0}for(m=k.length;m--;){n=k[m],j[n]&&(k.splice(m,1),delete this.shapes[n],l=m)}for(m=h.length;m--;){k.splice(l,0,h[m].id),this.shapes[h[m].id]=h[m]}},insertAfterShape:function(h,g){var j,i=this.shapeseq;for(j=i.length;j--;){if(i[j]===h){return i.splice(j+1,0,g.id),void (this.shapes[g.id]=g)}}},removeShapeId:function(h){var g,i=this.shapeseq;for(g=i.length;g--;){if(i[g]===h){i.splice(g,1);break}}delete this.shapes[h]},getShapeAt:function(h,g,i){return this.targetX=g,this.targetY=i,this.render(),this.currentTargetShapeId},render:function(){var i,h,n,m=this.shapeseq,l=this.shapes,k=m.length,j=this._getContext();for(j.clearRect(0,0,this.pixelWidth,this.pixelHeight),n=0;k>n;n++){i=m[n],h=l[i],this["_draw"+h.type].apply(this,h.args)}this.interact||(this.shapes={},this.shapeseq=[])}}),O=ap(S,{init:function(g,j,i){var h;O._super.init.call(this,g,j,i),i[0]&&(i=i[0]),ar.data(i,"_jqs_vcanvas",this),this.canvas=e.createElement("span"),ar(this.canvas).css({display:"inline-block",position:"relative",overflow:"hidden",width:g,height:j,margin:"0px",padding:"0px",verticalAlign:"top"}),this._insert(this.canvas,i),this._calculatePixelDims(g,j,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,h='<v:group coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'" style="position:absolute;top:0;left:0;width:'+this.pixelWidth+"px;height="+this.pixelHeight+'px;"></v:group>',this.canvas.insertAdjacentHTML("beforeEnd",h),this.group=ar(this.canvas).children()[0],this.rendered=!1,this.prerender=""},_drawShape:function(A,z,y,x,w){var v,u,t,s,r,q,p,o=[];for(p=0,q=z.length;q>p;p++){o[p]=""+z[p][0]+","+z[p][1]}return v=o.splice(0,1),w=w===f?1:w,u=y===f?' stroked="false" ':' strokeWeight="'+w+'px" strokeColor="'+y+'" ',t=x===f?' filled="false"':' fillColor="'+x+'" filled="true" ',s=o[0]===o[o.length-1]?"x ":"",r='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+A+'" '+u+t+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+v+" l "+o.join(", ")+" "+s+'e"> </v:shape>'},_drawCircle:function(u,t,s,r,q,p,o){var n,m,l;return t-=r,s-=r,n=q===f?' stroked="false" ':' strokeWeight="'+o+'px" strokeColor="'+q+'" ',m=p===f?' filled="false"':' fillColor="'+p+'" filled="true" ',l='<v:oval  id="jqsshape'+u+'" '+n+m+' style="position:absolute;top:'+s+"px; left:"+t+"px; width:"+2*r+"px; height:"+2*r+'px"></v:oval>'},_drawPieSlice:function(H,G,F,E,D,C,B,A){var z,y,x,w,v,u,t,s;if(D===C){return""}if(C-D===2*d.PI&&(D=0,C=2*d.PI),y=G+d.round(d.cos(D)*E),x=F+d.round(d.sin(D)*E),w=G+d.round(d.cos(C)*E),v=F+d.round(d.sin(C)*E),y===w&&x===v){if(C-D<d.PI){return""}y=w=G+E,x=v=F}return y===w&&x===v&&C-D<d.PI?"":(z=[G-E,F-E,G+E,F+E,y,x,w,v],u=B===f?' stroked="false" ':' strokeWeight="1px" strokeColor="'+B+'" ',t=A===f?' filled="false"':' fillColor="'+A+'" filled="true" ',s='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+H+'" '+u+t+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+G+","+F+" wa "+z.join(", ")+' x e"> </v:shape>')},_drawRect:function(i,h,n,m,l,k,j){return this._drawShape(i,[[h,n],[h,n+l],[h+m,n+l],[h+m,n],[h,n]],k,j)},reset:function(){this.group.innerHTML=""},appendShape:function(h){var g=this["_draw"+h.type].apply(this,h.args);return this.rendered?this.group.insertAdjacentHTML("beforeEnd",g):this.prerender+=g,this.lastShapeId=h.id,h.id},replaceWithShape:function(h,g){var j=ar("#jqsshape"+h),i=this["_draw"+g.type].apply(this,g.args);j[0].outerHTML=i},replaceWithShapes:function(i,h){var m,l=ar("#jqsshape"+i[0]),k="",j=h.length;for(m=0;j>m;m++){k+=this["_draw"+h[m].type].apply(this,h[m].args)}for(l[0].outerHTML=k,m=1;m<i.length;m++){ar("#jqsshape"+i[m]).remove()}},insertAfterShape:function(h,g){var j=ar("#jqsshape"+h),i=this["_draw"+g.type].apply(this,g.args);j[0].insertAdjacentHTML("afterEnd",i)},removeShapeId:function(h){var g=ar("#jqsshape"+h);this.group.removeChild(g[0])},getShapeAt:function(h){var g=h.id.substr(8);return g},render:function(){this.rendered||(this.group.innerHTML=this.prerender,this.rendered=!0)}})})}(document,Math);