(function(){var n=false;if(/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent)){document.addEventListener("click",function(){var p=window.event.target;if(n&&p!==null){var o=false;var q=p;while(q!==null&&q.tagName.toLowerCase()!=="html"&&!o){o=q.contentEditable==="true";q=q.parentNode}if(!o){document.getElementById("textAngular-editableFix-010203040506070809").setSelectionRange(0,0);p.focus()}}n=false},false);angular.element(document.body).append('<input id="textAngular-editableFix-010203040506070809" style="width:1px;height:1px;border:none;margin:0;padding:0;position:absolute; top: -10000; left: -10000;" unselectable="on" tabIndex="-1">')}var c=(function(){var r,t=-1;var q=window.navigator.userAgent;var p=q.indexOf("MSIE ");var o=q.indexOf("Trident/");if(p>0){t=parseInt(q.substring(p+5,q.indexOf(".",p)),10)}else{if(o>0){var s=q.indexOf("rv:");t=parseInt(q.substring(s+3,q.indexOf(".",s)),10)}}return((t>-1)?t:r)}());if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}}function b(o){try{return angular.element(o).length!==0}catch(p){return false}}var k,l,h;if(c>8||c===undefined){var g=(function(){var o=document.createElement("style");if(/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent)){o.appendChild(document.createTextNode(""))}document.head.insertBefore(o,document.head.firstChild);return o.sheet})();k=(function(){var o=document.createElement("style");if(/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent)){o.appendChild(document.createTextNode(""))}document.head.appendChild(o);return o.sheet})();l=function(o,p){_addCSSRule(k,o,p)};_addCSSRule=function(q,p,r){var o;if(q.rules){o=Math.max(q.rules.length-1,0)}else{if(q.cssRules){o=Math.max(q.cssRules.length-1,0)}}if(q.insertRule){q.insertRule(p+"{"+r+"}",o)}else{q.addRule(p,r,o)}return o};h=function(o){_removeCSSRule(k,o)};_removeCSSRule=function(p,o){if(p.removeRule){p.removeRule(o)}else{p.deleteRule(o)}};_addCSSRule(g,".ta-scroll-window.form-control","height: 160px; overflow: auto; font-family: inherit; font-size: 100%; position: relative; padding: 0;border:none;");_addCSSRule(g,".ta-root.focussed .ta-scroll-window.form-control","border:none;");_addCSSRule(g,".ta-editor.ta-html","min-height: 160px; height: auto; overflow: auto; font-family: inherit; font-size: 100%;");_addCSSRule(g,".ta-scroll-window .ta-bind","height: auto; min-height: 158px; padding:0px 8px 6px 8px;");_addCSSRule(g,".ta-root .ta-resizer-handle-overlay","z-index: 100; position: absolute; display: none;");_addCSSRule(g,".ta-root .ta-resizer-handle-overlay > .ta-resizer-handle-info","position: absolute; bottom: 16px; right: 16px; border: 1px solid black; background-color: #FFF; padding: 0 4px; opacity: 0.7;");_addCSSRule(g,".ta-root .ta-resizer-handle-overlay > .ta-resizer-handle-background","position: absolute; bottom: 5px; right: 5px; left: 5px; top: 5px; border: 1px solid black; background-color: rgba(0, 0, 0, 0.2);");_addCSSRule(g,".ta-root .ta-resizer-handle-overlay > .ta-resizer-handle-corner","width: 10px; height: 10px; position: absolute;");_addCSSRule(g,".ta-root .ta-resizer-handle-overlay > .ta-resizer-handle-corner-tl","top: 0; left: 0; border-left: 1px solid black; border-top: 1px solid black;");_addCSSRule(g,".ta-root .ta-resizer-handle-overlay > .ta-resizer-handle-corner-tr","top: 0; right: 0; border-right: 1px solid black; border-top: 1px solid black;");_addCSSRule(g,".ta-root .ta-resizer-handle-overlay > .ta-resizer-handle-corner-bl","bottom: 0; left: 0; border-left: 1px solid black; border-bottom: 1px solid black;");_addCSSRule(g,".ta-root .ta-resizer-handle-overlay > .ta-resizer-handle-corner-br","bottom: 0; right: 0; border: 1px solid black; cursor: se-resize; background-color: white;")}function e(o,p){var q=[];var r=o.children();if(r.length){angular.forEach(r,function(s){q=q.concat(e(angular.element(s),p))})}if(o.attr(p)!==undefined){q.push(o)}return q}var d=false;var j=angular.module("textAngular",["ngSanitize","textAngularSetup"]);var a={};function m(p,o){if(!p||p===""||a.hasOwnProperty(p)){throw ("textAngular Error: A unique name is required for a Tool Definition")}if((o.display&&(o.display===""||!b(o.display)))||(!o.display&&!o.buttontext&&!o.iconclass)){throw ('textAngular Error: Tool Definition for "'+p+'" does not have a valid display/iconclass/buttontext value')}a[p]=o}j.constant("taRegisterTool",m);j.value("taTools",a);j.config([function(){angular.forEach(a,function(p,o){delete a[o]})}]);j.directive("textAngular",["$compile","$timeout","taOptions","taSanitize","taSelection","taExecCommand","textAngularManager","$window","$document","$animate","$log",function(t,p,s,x,u,q,v,o,r,w,y){return{require:"?ngModel",scope:{},restrict:"EA",link:function(C,D,O,J){var A,B,N,F,z,L,E,Q,M=Math.floor(Math.random()*10000000000000000),K=(O.name)?O.name:"textAngularEditor"+M,I;var P=function(S,T,U){p(function(){var V=function(){S.off(T,V);U()};S.on(T,V)},100)};I=q(O.taDefaultWrap);angular.extend(C,angular.copy(s),{wrapSelection:function(U,T,S){I(U,false,T);if(S){C["reApplyOnSelectorHandlerstaTextElement"+M]()}C.displayElements.text[0].focus()},showHtml:false});if(O.taFocussedClass){C.classes.focussed=O.taFocussedClass}if(O.taTextEditorClass){C.classes.textEditor=O.taTextEditorClass}if(O.taHtmlEditorClass){C.classes.htmlEditor=O.taHtmlEditorClass}if(O.taTextEditorSetup){C.setup.textEditorSetup=C.$parent.$eval(O.taTextEditorSetup)}if(O.taHtmlEditorSetup){C.setup.htmlEditorSetup=C.$parent.$eval(O.taHtmlEditorSetup)}if(O.taFileDrop){C.fileDropHandler=C.$parent.$eval(O.taFileDrop)}else{C.fileDropHandler=C.defaultFileDropHandler}E=D[0].innerHTML;D[0].innerHTML="";C.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea></textarea>"),text:angular.element("<div></div>"),scrollWindow:angular.element("<div class='ta-scroll-window'></div>"),popover:angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"><div class="arrow"></div></div>'),popoverContainer:angular.element('<div class="popover-content"></div>'),resize:{overlay:angular.element('<div class="ta-resizer-handle-overlay"></div>'),background:angular.element('<div class="ta-resizer-handle-background"></div>'),anchors:[angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"></div>')],info:angular.element('<div class="ta-resizer-handle-info"></div>')}};C.displayElements.popover.append(C.displayElements.popoverContainer);C.displayElements.scrollWindow.append(C.displayElements.popover);C.displayElements.popover.on("mousedown",function(T,S){if(S){angular.extend(T,S)}T.preventDefault();return false});C.showPopover=function(S){C.reflowPopover(S);C.displayElements.popover.css("display","block");w.addClass(C.displayElements.popover,"in");P(D,"click keyup",function(){C.hidePopover()})};C.reflowPopover=function(S){if(C.displayElements.text[0].offsetHeight-51>S[0].offsetTop){C.displayElements.popover.css("top",S[0].offsetTop+S[0].offsetHeight+"px");C.displayElements.popover.removeClass("top").addClass("bottom")}else{C.displayElements.popover.css("top",S[0].offsetTop-54+"px");C.displayElements.popover.removeClass("bottom").addClass("top")}C.displayElements.popover.css("left",Math.max(0,Math.min(C.displayElements.text[0].offsetWidth-305,S[0].offsetLeft+(S[0].offsetWidth/2)-152.5))+"px")};C.hidePopover=function(){w.removeClass(C.displayElements.popover,"in",function(){C.displayElements.popover.css("display","");C.displayElements.popoverContainer.attr("style","");C.displayElements.popoverContainer.attr("class","popover-content")})};C.displayElements.resize.overlay.append(C.displayElements.resize.background);angular.forEach(C.displayElements.resize.anchors,function(S){C.displayElements.resize.overlay.append(S)});C.displayElements.resize.overlay.append(C.displayElements.resize.info);C.displayElements.scrollWindow.append(C.displayElements.resize.overlay);C.reflowResizeOverlay=function(S){S=angular.element(S)[0];C.displayElements.resize.overlay.css({display:"block",left:S.offsetLeft-5+"px",top:S.offsetTop-5+"px",width:S.offsetWidth+10+"px",height:S.offsetHeight+10+"px"});C.displayElements.resize.info.text(S.offsetWidth+" x "+S.offsetHeight)};C.showResizeOverlay=function(T){var S=function(X){var W={width:parseInt(T.attr("width")),height:parseInt(T.attr("height")),x:X.clientX,y:X.clientY};if(W.width===undefined){W.width=T[0].offsetWidth}if(W.height===undefined){W.height=T[0].offsetHeight}C.hidePopover();var V=W.height/W.width;var U=function(Z){var ab={x:Math.max(0,W.width+(Z.clientX-W.x)),y:Math.max(0,W.height+(Z.clientY-W.y))};var aa=function(ad,ac){ad=angular.element(ad);if(ad[0].tagName.toLowerCase()==="img"){if(ac.height){ad.attr("height",ac.height);delete ac.height}if(ac.width){ad.attr("width",ac.width);delete ac.width}}ad.css(ac)};if(Z.shiftKey){var Y=ab.y/ab.x;aa(T,{width:V>Y?ab.x:ab.y/V,height:V>Y?ab.x*V:ab.y})}else{aa(T,{width:ab.x,height:ab.y})}C.reflowResizeOverlay(T)};r.find("body").on("mousemove",U);P(C.displayElements.resize.overlay,"mouseup",function(){r.find("body").off("mousemove",U);C.showPopover(T)});X.stopPropagation();X.preventDefault()};C.displayElements.resize.anchors[3].on("mousedown",S);C.reflowResizeOverlay(T);P(D,"click",function(){C.hideResizeOverlay()})};C.hideResizeOverlay=function(){C.displayElements.resize.overlay.css("display","")};C.setup.htmlEditorSetup(C.displayElements.html);C.setup.textEditorSetup(C.displayElements.text);C.displayElements.html.attr({id:"taHtmlElement"+M,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html"});C.displayElements.text.attr({id:"taTextElement"+M,contentEditable:"true","ta-bind":"ta-bind","ng-model":"html"});C.displayElements.scrollWindow.attr({"ng-hide":"showHtml"});if(O.taDefaultWrap){C.displayElements.text.attr("ta-default-wrap",O.taDefaultWrap)}C.displayElements.scrollWindow.append(C.displayElements.text);D.append(C.displayElements.scrollWindow);D.append(C.displayElements.html);C.displayElements.forminput.attr("name",K);D.append(C.displayElements.forminput);if(O.tabindex){D.removeAttr("tabindex");C.displayElements.text.attr("tabindex",O.tabindex);C.displayElements.html.attr("tabindex",O.tabindex)}if(O.placeholder){C.displayElements.text.attr("placeholder",O.placeholder);C.displayElements.html.attr("placeholder",O.placeholder)}if(O.taDisabled){C.displayElements.text.attr("ta-readonly","disabled");C.displayElements.html.attr("ta-readonly","disabled");C.disabled=C.$parent.$eval(O.taDisabled);C.$parent.$watch(O.taDisabled,function(S){C.disabled=S;if(C.disabled){D.addClass(C.classes.disabled)}else{D.removeClass(C.classes.disabled)}})}t(C.displayElements.scrollWindow)(C);t(C.displayElements.html)(C);C.updateTaBindtaTextElement=C["updateTaBindtaTextElement"+M];C.updateTaBindtaHtmlElement=C["updateTaBindtaHtmlElement"+M];D.addClass("ta-root");C.displayElements.scrollWindow.addClass("ta-text ta-editor "+C.classes.textEditor);C.displayElements.html.addClass("ta-html ta-editor "+C.classes.htmlEditor);C._actionRunning=false;var G=false;C.startAction=function(){C._actionRunning=true;if(o.rangy&&o.rangy.saveSelection){G=o.rangy.saveSelection();return function(){if(G){o.rangy.restoreSelection(G)}}}};C.endAction=function(){C._actionRunning=false;if(G){o.rangy.removeMarkers(G)}G=false;C.updateSelectedStyles();if(!C.showHtml){C["updateTaBindtaTextElement"+M]()}};z=function(){D.addClass(C.classes.focussed);Q.focus()};C.displayElements.html.on("focus",z);C.displayElements.text.on("focus",z);L=function(S){if(!C._actionRunning&&r[0].activeElement!==C.displayElements.html[0]&&r[0].activeElement!==C.displayElements.text[0]){D.removeClass(C.classes.focussed);Q.unfocus();p(function(){D.triggerHandler("blur")},0)}S.preventDefault();return false};C.displayElements.html.on("blur",L);C.displayElements.text.on("blur",L);C.queryFormatBlockState=function(S){return S.toLowerCase()===r[0].queryCommandValue("formatBlock").toLowerCase()};C.switchView=function(){C.showHtml=!C.showHtml;if(C.showHtml){p(function(){return C.displayElements.html[0].focus()},100)}else{p(function(){return C.displayElements.text[0].focus()},100)}};if(O.ngModel){var H=true;J.$render=function(){if(H){H=false;var S=C.$parent.$eval(O.ngModel);if((S===undefined||S===null)&&(E&&E!=="")){J.$setViewValue(E)}}C.displayElements.forminput.val(J.$viewValue);if(!C._elementSelectTriggered&&r[0].activeElement!==C.displayElements.html[0]&&r[0].activeElement!==C.displayElements.text[0]){C.html=J.$viewValue||""}}}else{C.displayElements.forminput.val(E);C.html=E}C.$watch("html",function(T,S){if(T!==S){if(O.ngModel&&J.$viewValue!==T){J.$setViewValue(T)}C.displayElements.forminput.val(T)}});if(O.taTargetToolbars){Q=v.registerEditor(K,C,O.taTargetToolbars.split(","))}else{var R=angular.element('<div text-angular-toolbar name="textAngularToolbar'+M+'">');if(O.taToolbar){R.attr("ta-toolbar",O.taToolbar)}if(O.taToolbarClass){R.attr("ta-toolbar-class",O.taToolbarClass)}if(O.taToolbarGroupClass){R.attr("ta-toolbar-group-class",O.taToolbarGroupClass)}if(O.taToolbarButtonClass){R.attr("ta-toolbar-button-class",O.taToolbarButtonClass)}if(O.taToolbarActiveButtonClass){R.attr("ta-toolbar-active-button-class",O.taToolbarActiveButtonClass)}if(O.taFocussedClass){R.attr("ta-focussed-class",O.taFocussedClass)}D.prepend(R);t(R)(C.$parent);Q=v.registerEditor(K,C,["textAngularToolbar"+M])}C.$on("$destroy",function(){v.unregisterEditor(K)});C.$on("ta-element-select",function(T,S){Q.triggerElementSelect(T,S)});C.$on("ta-drop-event",function(U,S,T,V){C.displayElements.text[0].focus();if(V&&V.files&&V.files.length>0){angular.forEach(V.files,function(X){try{return C.fileDropHandler(X,C.wrapSelection)||(C.fileDropHandler!==C.defaultFileDropHandler&&C.defaultFileDropHandler(X,C.wrapSelection))}catch(W){y.error(W)}});T.preventDefault();T.stopPropagation()}});C._bUpdateSelectedStyles=false;C.updateSelectedStyles=function(){var S;if((S=u.getSelectionElement())!==undefined&&S.parentNode!==C.displayElements.text[0]){Q.updateSelectedStyles(angular.element(S))}else{Q.updateSelectedStyles()}if(C._bUpdateSelectedStyles){p(C.updateSelectedStyles,200)}};A=function(){if(!C._bUpdateSelectedStyles){C._bUpdateSelectedStyles=true;C.$apply(function(){C.updateSelectedStyles()})}};C.displayElements.html.on("keydown",A);C.displayElements.text.on("keydown",A);B=function(){C._bUpdateSelectedStyles=false};C.displayElements.html.on("keyup",B);C.displayElements.text.on("keyup",B);N=function(T,S){if(S){angular.extend(T,S)}C.$apply(function(){if(Q.sendKeyCommand(T)){if(!C._bUpdateSelectedStyles){C.updateSelectedStyles()}T.preventDefault();return false}})};C.displayElements.html.on("keypress",N);C.displayElements.text.on("keypress",N);F=function(){C._bUpdateSelectedStyles=false;C.$apply(function(){C.updateSelectedStyles()})};C.displayElements.html.on("mouseup",F);C.displayElements.text.on("mouseup",F)}}}]).factory("taBrowserTag",[function(){return function(o){if(!o){return(c<=8)?"P":"p"}else{if(o===""){return(c===undefined)?"div":(c<=8)?"P":"p"}else{return(c<=8)?o.toUpperCase():o}}}}]).factory("taExecCommand",["taSelection","taBrowserTag","$document",function(q,p,u){var o=/(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)/ig;var v=/(ul|li|ol)/ig;var t=function(y,z){var w;var x=y.find("li");for(i=x.length-1;i>=0;i--){w=angular.element("<"+z+">"+x[i].innerHTML+"</"+z+">");y.after(w)}y.remove();q.setSelectionToElementEnd(w[0])};var s=function(x,y){var w=angular.element("<"+y+">"+x[0].innerHTML+"</"+y+">");x.after(w);x.remove();q.setSelectionToElementEnd(w.find("li")[0])};var r=function(z,y,A){var x="";for(i=z.length-1;i>=0;i--){x+="<"+p("li")+">"+z[i].innerHTML+"</"+p("li")+">"}var w=angular.element("<"+A+">"+x+"</"+A+">");y.after(w);y.remove();q.setSelectionToElementEnd(w.find("li")[0])};return function(w){w=p(w);return function(B,x,A){var K,z,G,C,I;var Q=angular.element("<"+w+">");var J=q.getSelectionElement();var P=angular.element(J);if(J!==undefined){var y=J.tagName.toLowerCase();if(B.toLowerCase()==="insertorderedlist"||B.toLowerCase()==="insertunorderedlist"){var H=p((B.toLowerCase()==="insertorderedlist")?"ol":"ul");if(y===H){return t(P,w)}else{if(y==="li"&&P.parent()[0].tagName.toLowerCase()===H&&P.parent().children().length===1){return t(P.parent(),w)}else{if(y==="li"&&P.parent()[0].tagName.toLowerCase()!==H&&P.parent().children().length===1){return s(P.parent(),H)}else{if(y.match(o)&&!P.hasClass("ta-bind")){if(y==="ol"||y==="ul"){return s(P,H)}else{if(J.innerHTML.match(o)){return r(P.children(),P,H)}else{return r(angular.element("<div>"+J.innerHTML+"</div>"),P,H)}}}else{if(y.match(o)){C=q.getOnlySelectedElements();if(C.length===1&&(C[0].tagName.toLowerCase()==="ol"||C[0].tagName.toLowerCase()==="ul")){if(C[0].tagName.toLowerCase()===H){return t(angular.element(C[0]),w)}else{return s(angular.element(C[0]),H)}}else{G="";var D=[];for(K=0;K<C.length;K++){if(C[K].nodeType!==3){var N=angular.element(C[K]);G+="<"+p("li")+">"+N[0].innerHTML+"</"+p("li")+">";D.unshift(N)}}z=angular.element("<"+H+">"+G+"</"+H+">");D.pop().replaceWith(z);angular.forEach(D,function(R){R.remove()})}q.setSelectionToElementEnd(z[0]);return}}}}}}else{if(B.toLowerCase()==="formatblock"&&"blockquote"===A.toLowerCase().replace(/[<>]/ig,"")){if(y==="li"){z=P.parent()}else{z=P}while(!z[0].tagName.match(o)){z=z.parent();y=z[0].tagName.toLowerCase()}if(y===A.toLowerCase().replace(/[<>]/ig,"")){C=z.children();var O=false;for(K=0;K<C.length;K++){O=O||C[K].tagName.match(o)}if(O){z.after(C);I=z.next();z.remove();z=I}else{Q.append(z[0].childNodes);z.after(Q);z.remove();z=Q}}else{if(z.parent()[0].tagName.toLowerCase()===A.toLowerCase().replace(/[<>]/ig,"")&&!z.parent().hasClass("ta-bind")){var E=z.parent();var L=E.contents();for(K=0;K<L.length;K++){if(E.parent().hasClass("ta-bind")&&L[K].nodeType===3){Q=angular.element("<"+w+">");Q[0].innerHTML=L[K].outerHTML;L[K]=Q[0]}E.parent()[0].insertBefore(L[K],E[0])}E.remove()}else{if(y.match(v)){z.wrap(A)}else{C=q.getOnlySelectedElements();if(C.length===0){C=[z[0]]}G="";if(C.length===1&&C[0].nodeType===3){var F=C[0].parentNode;while(!F.tagName.match(o)){F=F.parentNode}C=[F]}for(K=0;K<C.length;K++){G+=C[K].outerHTML}z=angular.element(A);z[0].innerHTML=G;C[0].parentNode.insertBefore(z[0],C[0]);angular.forEach(C,function(R){R.parentNode.removeChild(R)})}}}q.setSelectionToElementEnd(z[0]);return}}}try{u[0].execCommand(B,x,A)}catch(M){}}}}]).directive("taBind",["taSanitize","$timeout","$window","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers",function(v,q,p,r,s,o,t,w,u){return{require:"ngModel",scope:{},link:function(L,C,J,B){var x=C.attr("contenteditable")!==undefined&&C.attr("contenteditable");var D=x||C[0].tagName.toLowerCase()==="textarea"||C[0].tagName.toLowerCase()==="input";var y=false;var H=false;var F,E;if(J.taDefaultWrap===undefined){J.taDefaultWrap="p"}if(J.taDefaultWrap===""){F="";E=(c===undefined)?"<div><br></div>":(c>=11)?"<p><br></p>":(c<=8)?"<P>&nbsp;</P>":"<p>&nbsp;</p>"}else{F=(c===undefined||c>=11)?"<"+J.taDefaultWrap+"><br></"+J.taDefaultWrap+">":(c<=8)?"<"+J.taDefaultWrap.toUpperCase()+"></"+J.taDefaultWrap.toUpperCase()+">":"<"+J.taDefaultWrap+"></"+J.taDefaultWrap+">";E=(c===undefined||c>=11)?"<"+J.taDefaultWrap+"><br></"+J.taDefaultWrap+">":(c<=8)?"<"+J.taDefaultWrap.toUpperCase()+">&nbsp;</"+J.taDefaultWrap.toUpperCase()+">":"<"+J.taDefaultWrap+">&nbsp;</"+J.taDefaultWrap+">"}C.addClass("ta-bind");var K=function(){if(x){return C[0].innerHTML}if(D){return C.val()}throw ("textAngular Error: attempting to update non-editable taBind")};L.$parent["updateTaBind"+(J.id||"")]=function(){if(!y){B.$setViewValue(K())}};if(D){if(!x){C.on("paste cut",function(){if(!y){q(function(){B.$setViewValue(K())},0)}});C.on("change blur",function(){if(!y){B.$setViewValue(K())}})}else{C.on("cut",function(M){if(!y){q(function(){B.$setViewValue(K())},0)}else{M.preventDefault()}});C.on("paste",function(P,N){if(N){angular.extend(P,N)}var Q;if(P.clipboardData||(P.originalEvent&&P.originalEvent.clipboardData)){Q=(P.originalEvent||P).clipboardData.getData("text/plain")}else{if(p.clipboardData){Q=p.clipboardData.getData("Text")}}if(!Q&&!y){return true}P.preventDefault();if(!y){var O=angular.element("<div></div>");O[0].innerHTML=Q;Q=O.text();if(r[0].selection){var M=r[0].selection.createRange();M.pasteHTML(Q)}else{r[0].execCommand("insertText",false,Q)}B.$setViewValue(K())}});C.on("keyup",function(P,O){if(O){angular.extend(P,O)}if(!y){if(F!==""&&P.keyCode===13){if(!P.shiftKey){var M=t.getSelectionElement();if(M.tagName.toLowerCase()!==J.taDefaultWrap&&M.tagName.toLowerCase()!=="li"&&(M.innerHTML.trim()===""||M.innerHTML.trim()==="<br>")){var N=angular.element(F);angular.element(M).replaceWith(N);t.setSelectionToElementStart(N[0])}}}var Q=K();if(F!==""&&Q.trim()===""){C[0].innerHTML=F;t.setSelectionToElementStart(C.children()[0])}B.$setViewValue(Q)}});C.on("blur",function(){H=false;var M=K();if(!y){if(M===E){B.$setViewValue("")}else{B.$setViewValue(K())}}B.$render()});if(J.placeholder&&(c>8||c===undefined)){var A;if(J.id){A=l("#"+J.id+".placeholder-text:before",'content: "'+J.placeholder+'"')}else{throw ("textAngular Error: An unique ID is required for placeholders to work")}L.$on("$destroy",function(){h(A)})}C.on("focus",function(){H=true;B.$render()})}}var z=function(M){return(B.$oldViewValue=v(s(M),B.$oldViewValue))};B.$parsers.push(z);B.$formatters.push(z);var G=function(M){L.$emit("ta-element-select",this);M.preventDefault();return false};var I=function(N,M){if(M){angular.extend(N,M)}if(!d&&!y){d=true;var O;if(N.originalEvent){O=N.originalEvent.dataTransfer}else{O=N.dataTransfer}L.$emit("ta-drop-event",this,N,O);q(function(){d=false},100)}};L.$parent["reApplyOnSelectorHandlers"+(J.id||"")]=function(){if(!y){angular.forEach(w,function(M){C.find(M).off("click",G).on("click",G)})}};B.$render=function(){var M=B.$viewValue||"";if(r[0].activeElement!==C[0]){if(x){if(J.placeholder){if(M===""){if(H){C.removeClass("placeholder-text")}else{C.addClass("placeholder-text")}C[0].innerHTML=F}else{C.removeClass("placeholder-text");C[0].innerHTML=M}}else{if(M===""){C[0].innerHTML=F}else{C[0].innerHTML=M}}if(!y){angular.forEach(w,function(N){C.find(N).on("click",G)});C.on("drop",I)}else{C.off("drop",I)}}else{if(C[0].tagName.toLowerCase()!=="textarea"&&C[0].tagName.toLowerCase()!=="input"){C[0].innerHTML=u(M)}else{C.val(M)}}}else{if(x){C.removeClass("placeholder-text")}}};if(J.taReadonly){y=L.$parent.$eval(J.taReadonly);if(y){C.addClass("ta-readonly");if(C[0].tagName.toLowerCase()==="textarea"||C[0].tagName.toLowerCase()==="input"){C.attr("disabled","disabled")}if(C.attr("contenteditable")!==undefined&&C.attr("contenteditable")){C.removeAttr("contenteditable")}}else{C.removeClass("ta-readonly");if(C[0].tagName.toLowerCase()==="textarea"||C[0].tagName.toLowerCase()==="input"){C.removeAttr("disabled")}else{if(x){C.attr("contenteditable","true")}}}L.$parent.$watch(J.taReadonly,function(N,M){if(M===N){return}if(N){C.addClass("ta-readonly");if(C[0].tagName.toLowerCase()==="textarea"||C[0].tagName.toLowerCase()==="input"){C.attr("disabled","disabled")}if(C.attr("contenteditable")!==undefined&&C.attr("contenteditable")){C.removeAttr("contenteditable")}angular.forEach(w,function(O){C.find(O).on("click",G)});C.off("drop",I)}else{C.removeClass("ta-readonly");if(C[0].tagName.toLowerCase()==="textarea"||C[0].tagName.toLowerCase()==="input"){C.removeAttr("disabled")}else{if(x){C.attr("contenteditable","true")}}angular.forEach(w,function(O){C.find(O).off("click",G)});C.on("drop",I)}y=N})}if(x&&!y){angular.forEach(w,function(M){C.find(M).on("click",G)});C.on("drop",I);C.on("blur",function(){if(/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent)){n=true}})}}}}]).factory("taApplyCustomRenderers",["taCustomRenderers",function(o){return function(q){var p=angular.element("<div></div>");p[0].innerHTML=q;angular.forEach(o,function(s){var r=[];if(s.selector&&s.selector!==""){r=p.find(s.selector)}else{if(s.customAttribute&&s.customAttribute!==""){r=e(p,s.customAttribute)}}angular.forEach(r,function(t){t=angular.element(t);if(s.selector&&s.selector!==""&&s.customAttribute&&s.customAttribute!==""){if(t.attr(s.customAttribute)!==undefined){s.renderLogic(t)}}else{s.renderLogic(t)}})});return p[0].innerHTML}}]).directive("taMaxText",function(){return{restrict:"A",require:"ngModel",link:function(r,s,p,t){var o=parseInt(r.$eval(p.taMaxText));if(isNaN(o)){throw ("Max text must be an integer")}p.$observe("taMaxText",function(u){o=parseInt(u);if(isNaN(o)){throw ("Max text must be an integer")}if(t.$dirty){t.$setViewValue(t.$viewValue)}});function q(w){var v=angular.element("<div/>");v.html(w);var u=v.text().length;if(u<=o){t.$setValidity("taMaxText",true);return w}else{t.$setValidity("taMaxText",false);return undefined}}t.$parsers.unshift(q)}}}).factory("taFixChrome",function(){var o=function(t){var q=angular.element("<div>"+t+"</div>");var r=angular.element(q).find("span");for(var v=0;v<r.length;v++){var u=angular.element(r[v]);if(u.attr("style")&&u.attr("style").match(/line-height: 1.428571429;|color: inherit; line-height: 1.1;/i)){u.attr("style",u.attr("style").replace(/( |)font-family: inherit;|( |)line-height: 1.428571429;|( |)line-height:1.1;|( |)color: inherit;/ig,""));if(!u.attr("style")||u.attr("style")===""){if(u.next().length>0&&u.next()[0].tagName==="BR"){u.next().remove()}u.replaceWith(u[0].innerHTML)}}}var p=q[0].innerHTML.replace(/style="[^"]*?(line-height: 1.428571429;|color: inherit; line-height: 1.1;)[^"]*"/ig,"");if(p!==q[0].innerHTML){q[0].innerHTML=p}return q[0].innerHTML};return o}).factory("taSanitize",["$sanitize",function f(p){return function o(s,r){var q=angular.element("<div>"+s+"</div>");angular.forEach(e(q,"align"),function(v){v.css("text-align",v.attr("align"));v.removeAttr("align")});s=q[0].innerHTML;return s;var t;try{t=p(s)}catch(u){t=r||""}return t}}]).directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction","$window",function(o,t,q,p,r,s){return{scope:{name:"@"},restrict:"EA",link:function(x,w,v){if(!x.name||x.name===""){throw ("textAngular Error: A toolbar requires a name")}angular.extend(x,angular.copy(q));if(v.taToolbar){x.toolbar=x.$parent.$eval(v.taToolbar)}if(v.taToolbarClass){x.classes.toolbar=v.taToolbarClass}if(v.taToolbarGroupClass){x.classes.toolbarGroup=v.taToolbarGroupClass}if(v.taToolbarButtonClass){x.classes.toolbarButton=v.taToolbarButtonClass}if(v.taToolbarActiveButtonClass){x.classes.toolbarButtonActive=v.taToolbarActiveButtonClass}if(v.taFocussedClass){x.classes.focussed=v.taFocussedClass}x.disabled=true;x.focussed=false;x._$element=w;w[0].innerHTML="";w.addClass("ta-toolbar "+x.classes.toolbar);x.$watch("focussed",function(){if(x.focussed){w.addClass(x.classes.focussed)}else{w.removeClass(x.classes.focussed)}});var u=function(z,C){var D;if(z&&z.display){D=angular.element(z.display)}else{D=angular.element("<button type='button'>")}D.addClass(x.classes.toolbarButton);D.attr("name",C.name);D.attr("unselectable","on");D.attr("ng-disabled","isDisabled()");D.attr("tabindex","-1");D.attr("ng-click","executeAction()");D.attr("ng-class","displayActiveToolClass(active)");D.on("mousedown",function(F,E){if(E){angular.extend(F,E)}F.preventDefault();return false});if(z&&!z.display&&!C._display){D[0].innerHTML="";if(z.buttontext){D[0].innerHTML=z.buttontext}if(z.iconclass){var A=angular.element("<i>"),B=D[0].innerHTML;A.addClass(z.iconclass);D[0].innerHTML="";D.append(A);if(B&&B!==""){D.append("&nbsp;"+B)}}}C._lastToolDefinition=angular.copy(z);return o(D)(C)};x.tools={};x._parent={disabled:true,showHtml:false,queryFormatBlockState:function(){return false}};var y={$window:s,$editor:function(){return x._parent},isDisabled:function(){return(this.$eval("disabled")||this.$eval("disabled()")||(this.name!=="html"&&this.$editor().showHtml)||this.$parent.disabled||this.$editor().disabled)},displayActiveToolClass:function(z){return(z)?x.classes.toolbarButtonActive:""},executeAction:r};angular.forEach(x.toolbar,function(A){var z=angular.element("<div>");z.addClass(x.classes.toolbarGroup);angular.forEach(A,function(B){x.tools[B]=angular.extend(x.$new(true),p[B],y,{name:B});x.tools[B].$element=u(p[B],x.tools[B]);z.append(x.tools[B].$element)});w.append(z)});x.updateToolDisplay=function(z,C,A){var B=x.tools[z];if(B){if(B._lastToolDefinition&&!A){C=angular.extend({},B._lastToolDefinition,C)}if(C.buttontext===null&&C.iconclass===null&&C.display===null){throw ('textAngular Error: Tool Definition for updating "'+z+'" does not have a valid display/iconclass/buttontext value')}if(C.buttontext===null){delete C.buttontext}if(C.iconclass===null){delete C.iconclass}if(C.display===null){delete C.display}var D=u(C,B);B.$element.replaceWith(D);B.$element=D}};x.addTool=function(A,D,B,z){x.tools[A]=angular.extend(x.$new(true),p[A],y,{name:A});x.tools[A].$element=u(p[A],x.tools[A]);var C;if(B===undefined){B=x.toolbar.length-1}C=angular.element(w.children()[B]);if(z===undefined){C.append(x.tools[A].$element);x.toolbar[B][x.toolbar[B].length-1]=A}else{C.children().eq(z).after(x.tools[A].$element);x.toolbar[B][z]=A}};t.registerToolbar(x);x.$on("$destroy",function(){t.unregisterToolbar(x.name)})}}}]).service("taToolExecuteAction",["$q",function(o){return function(r){if(r!==undefined){this.$editor=function(){return r}}var q=o.defer(),u=q.promise,t=this.$editor();u["finally"](function(){t.endAction.call(t)});var p;try{p=this.action(q,t.startAction())}catch(s){}if(p||p===undefined){q.resolve()}}}]).service("textAngularManager",["taToolExecuteAction","taTools","taRegisterTool",function(s,o,r){var q={},p={};return{registerEditor:function(u,v,t){if(!u||u===""){throw ("textAngular Error: An editor requires a name")}if(!v){throw ("textAngular Error: An editor requires a scope")}if(p[u]){throw ('textAngular Error: An Editor with name "'+u+'" already exists')}var w=[];angular.forEach(t,function(x){if(q[x]){w.push(q[x])}});p[u]={scope:v,toolbars:t,_registerToolbar:function(x){if(this.toolbars.indexOf(x.name)>=0){w.push(x)}},editorFunctions:{disable:function(){angular.forEach(w,function(x){x.disabled=true})},enable:function(){angular.forEach(w,function(x){x.disabled=false})},focus:function(){angular.forEach(w,function(x){x._parent=v;x.disabled=false;x.focussed=true})},unfocus:function(){angular.forEach(w,function(x){x.disabled=true;x.focussed=false})},updateSelectedStyles:function(x){angular.forEach(w,function(y){angular.forEach(y.tools,function(z){if(z.activeState){z.active=z.activeState(x)}})})},sendKeyCommand:function(y){var x=false;if(y.ctrlKey||y.metaKey){angular.forEach(o,function(A,z){if(A.commandKeyCode&&A.commandKeyCode===y.which){for(var B=0;B<w.length;B++){if(w[B].tools[z]!==undefined){s.call(w[B].tools[z],v);x=true;break}}}})}return x},triggerElementSelect:function(y,A){var E=function(I,J){var H=true;for(var K=0;K<J.length;K++){H=H&&I.attr(J[K])}return H};var C=[];var D={};var G=false;A=angular.element(A);var z=false;angular.forEach(o,function(I,H){if(I.onElementSelect&&I.onElementSelect.element&&I.onElementSelect.element.toLowerCase()===A[0].tagName.toLowerCase()&&(!I.onElementSelect.filter||I.onElementSelect.filter(A))){z=z||(angular.isArray(I.onElementSelect.onlyWithAttrs)&&E(A,I.onElementSelect.onlyWithAttrs));if(!I.onElementSelect.onlyWithAttrs||E(A,I.onElementSelect.onlyWithAttrs)){D[H]=I}}});if(z){angular.forEach(D,function(I,H){if(I.onElementSelect.onlyWithAttrs&&E(A,I.onElementSelect.onlyWithAttrs)){C.push({name:H,tool:I})}});C.sort(function(I,H){return H.tool.onElementSelect.onlyWithAttrs.length-I.tool.onElementSelect.onlyWithAttrs.length})}else{angular.forEach(D,function(I,H){C.push({name:H,tool:I})})}if(C.length>0){var B=C[0].tool;var x=C[0].name;for(var F=0;F<w.length;F++){if(w[F].tools[x]!==undefined){B.onElementSelect.action.call(w[F].tools[x],y,A,v);G=true;break}}}return G}}};return p[u].editorFunctions},retrieveEditor:function(t){return p[t]},unregisterEditor:function(t){delete p[t]},registerToolbar:function(t){if(!t){throw ("textAngular Error: A toolbar requires a scope")}if(!t.name||t.name===""){throw ("textAngular Error: A toolbar requires a name")}if(q[t.name]){throw ('textAngular Error: A toolbar with name "'+t.name+'" already exists')}q[t.name]=t;angular.forEach(p,function(u){u._registerToolbar(t)})},retrieveToolbar:function(t){return q[t]},retrieveToolbarsViaEditor:function(u){var t=[],v=this;angular.forEach(this.retrieveEditor(u).toolbars,function(w){t.push(v.retrieveToolbar(w))});return t},unregisterToolbar:function(t){delete q[t]},updateToolsDisplay:function(t){var u=this;angular.forEach(t,function(w,v){u.updateToolDisplay(v,w)})},resetToolsDisplay:function(){var t=this;angular.forEach(o,function(v,u){t.resetToolDisplay(u)})},updateToolDisplay:function(t,u){var v=this;angular.forEach(q,function(w,x){v.updateToolbarToolDisplay(x,t,u)})},resetToolDisplay:function(t){var u=this;angular.forEach(q,function(v,w){u.resetToolbarToolDisplay(w,t)})},updateToolbarToolDisplay:function(v,t,u){if(q[v]){q[v].updateToolDisplay(t,u)}else{throw ('textAngular Error: No Toolbar with name "'+v+'" exists')}},resetToolbarToolDisplay:function(u,t){if(q[u]){q[u].updateToolDisplay(t,o[t],true)}else{throw ('textAngular Error: No Toolbar with name "'+u+'" exists')}},removeTool:function(t){delete o[t];angular.forEach(q,function(u){delete u.tools[t];for(var w=0;w<u.toolbar.length;w++){var x;for(var v=0;v<u.toolbar[w].length;v++){if(u.toolbar[w][v]===t){x={group:w,index:v};break}if(x!==undefined){break}}if(x!==undefined){u.toolbar[x.group].slice(x.index,1);u._$element.children().eq(x.group).children().eq(x.index).remove()}}})},addTool:function(t,u,w,v){r(t,u);angular.forEach(q,function(x){x.addTool(t,u,w,v)})},addToolToToolbar:function(t,u,x,w,v){r(t,u);q[x].addTool(t,u,w,v)},refreshEditor:function(t){if(p[t]){p[t].scope.updateTaBindtaTextElement();if(!p[t].scope.$$phase){p[t].scope.$digest()}}else{throw ('textAngular Error: No Editor with name "'+t+'" exists')}}}}]).service("taSelection",["$window","$document",function(r,q){_document=q[0];var o=function(s){if(s.hasChildNodes()){return s.firstChild}else{while(s&&!s.nextSibling){s=s.parentNode}if(!s){return null}return s.nextSibling}};var p=function(t){var u=t.startContainer;var s=t.endContainer;if(u===s){return[u]}var v=[];while(u&&u!==s){u=o(u);if(u.parentNode===t.commonAncestorContainer){v.push(u)}}u=t.startContainer;while(u&&u!==t.commonAncestorContainer){if(u.parentNode===t.commonAncestorContainer){v.unshift(u)}u=u.parentNode}return v};return{getOnlySelectedElements:function(){if(window.getSelection){var s=r.getSelection();if(!s.isCollapsed){return p(s.getRangeAt(0))}}return[]},getSelectionElement:function(){var t,u,s;if(_document.selection&&_document.selection.createRange){t=_document.selection.createRange();return t.parentElement()}else{if(r.getSelection){u=r.getSelection();if(u.getRangeAt){if(u.rangeCount>0){t=u.getRangeAt(0)}}else{t=_document.createRange();t.setStart(u.anchorNode,u.anchorOffset);t.setEnd(u.focusNode,u.focusOffset);if(t.collapsed!==u.isCollapsed){t.setStart(u.focusNode,u.focusOffset);t.setEnd(u.anchorNode,u.anchorOffset)}}if(t){s=t.commonAncestorContainer;return s.nodeType===3?s.parentNode:s}}}},setSelectionToElementStart:function(t){if(_document.createRange&&r.getSelection){var s=_document.createRange();s.selectNodeContents(t);s.setStart(t,0);s.setEnd(t,0);var v=r.getSelection();v.removeAllRanges();v.addRange(s)}else{if(_document.selection&&_document.body.createTextRange){var u=_document.body.createTextRange();u.moveToElementText(t);u.collapse(true);u.moveEnd("character",0);u.moveStart("character",0);u.select()}}},setSelectionToElementEnd:function(t){if(_document.createRange&&r.getSelection){var s=_document.createRange();s.selectNodeContents(t);s.collapse(false);var v=r.getSelection();v.removeAllRanges();v.addRange(s)}else{if(_document.selection&&_document.body.createTextRange){var u=_document.body.createTextRange();u.moveToElementText(t);u.collapse(false);u.select()}}}}}])})();