textAngularSetup=angular.module("textAngularSetup",[]);textAngularSetup.value("taOptions",{toolbar:[["bold","italics","underline","redo","undo","clear"],["insertImage","uploadImage","insertLink","insertVideo"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-link btn-sm",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"},setup:{textEditorSetup:function(a){},htmlEditorSetup:function(a){}},defaultFileDropHandler:function(c,b){var a=new FileReader();if(c.type.substring(0,5)==="image"){a.onload=function(){if(a.result!==""){b("insertImage",a.result,true)}};a.readAsDataURL(c);return true}return false}});textAngularSetup.value("taSelectableElements",["a","img"]);textAngularSetup.value("taCustomRenderers",[{selector:"img",customAttribute:"ta-insert-video",renderLogic:function(b){var c=angular.element("<iframe></iframe>");var a=b.prop("attributes");angular.forEach(a,function(d){c.attr(d.name,d.value)});c.attr("src",c.attr("ta-insert-video"));b.replaceWith(c)}}]);textAngularSetup.constant("taTranslations",{toggleHTML:"Toggle HTML",uploadImage:"Please enter a image URL to insert",insertImage:"Please enter a image URL to insert",insertLink:"Please enter a URL to insert",insertVideo:"Please enter a youtube URL to embed"});textAngularSetup.run(["taRegisterTool","$window","taTranslations","taSelection",function(f,g,c,e){f("html",{buttontext:c.toggleHTML,action:function(){this.$editor().switchView()},activeState:function(){return this.$editor().showHtml}});var a=function(h){return function(){return this.$editor().queryFormatBlockState(h)}};var d=function(){return this.$editor().wrapSelection("formatBlock","<"+this.name.toUpperCase()+">")};angular.forEach(["h1","h2","h3","h4","h5","h6"],function(i){f(i.toLowerCase(),{buttontext:i.toUpperCase(),action:d,activeState:a(i.toLowerCase())})});f("p",{buttontext:"P",action:function(){return this.$editor().wrapSelection("formatBlock","<P>")},activeState:function(){return this.$editor().queryFormatBlockState("p")}});f("pre",{buttontext:"pre",action:function(){return this.$editor().wrapSelection("formatBlock","<PRE>")},activeState:function(){return this.$editor().queryFormatBlockState("pre")}});f("ul",{iconclass:"fa fa-list-ul",action:function(){return this.$editor().wrapSelection("insertUnorderedList",null)},activeState:function(){return document.queryCommandState("insertUnorderedList")}});f("ol",{iconclass:"fa fa-list-ol",action:function(){return this.$editor().wrapSelection("insertOrderedList",null)},activeState:function(){return document.queryCommandState("insertOrderedList")}});f("quote",{iconclass:"fa fa-quote-right",action:function(){return this.$editor().wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}});f("undo",{iconclass:"fa fa-undo",action:function(){return this.$editor().wrapSelection("undo",null)}});f("redo",{iconclass:"fa fa-repeat",action:function(){return this.$editor().wrapSelection("redo",null)}});f("bold",{iconclass:"fa fa-bold",action:function(){return this.$editor().wrapSelection("bold",null)},activeState:function(){return document.queryCommandState("bold")},commandKeyCode:98});f("justifyLeft",{iconclass:"fa fa-align-left",action:function(){return this.$editor().wrapSelection("justifyLeft",null)},activeState:function(i){var h=false;if(i){h=i.css("text-align")==="left"||i.attr("align")==="left"||(i.css("text-align")!=="right"&&i.css("text-align")!=="center"&&!document.queryCommandState("justifyRight")&&!document.queryCommandState("justifyCenter"))}h=h||document.queryCommandState("justifyLeft");return h}});f("justifyRight",{iconclass:"fa fa-align-right",action:function(){return this.$editor().wrapSelection("justifyRight",null)},activeState:function(i){var h=false;if(i){h=i.css("text-align")==="right"}h=h||document.queryCommandState("justifyRight");return h}});f("justifyCenter",{iconclass:"fa fa-align-center",action:function(){return this.$editor().wrapSelection("justifyCenter",null)},activeState:function(i){var h=false;if(i){h=i.css("text-align")==="center"}h=h||document.queryCommandState("justifyCenter");return h}});f("italics",{iconclass:"fa fa-italic",action:function(){return this.$editor().wrapSelection("italic",null)},activeState:function(){return document.queryCommandState("italic")},commandKeyCode:105});f("underline",{iconclass:"fa fa-underline",action:function(){return this.$editor().wrapSelection("underline",null)},activeState:function(){return document.queryCommandState("underline")},commandKeyCode:117});f("clear",{iconclass:"fa fa-ban",action:function(h,l){this.$editor().wrapSelection("removeFormat",null);var m=angular.element(e.getSelectionElement());var i=function(o){o=angular.element(o);var n=o;angular.forEach(o.children(),function(q){var p=angular.element("<p></p>");p.html(angular.element(q).html());n.after(p);n=p});o.remove()};angular.forEach(m.find("ul"),i);angular.forEach(m.find("ol"),i);var k=this.$editor();var j=function(n){n=angular.element(n);if(n[0]!==k.displayElements.text[0]){n.removeAttr("class")}angular.forEach(n.children(),j)};angular.forEach(m,j);if(m[0].tagName.toLowerCase()!=="li"&&m[0].tagName.toLowerCase()!=="ol"&&m[0].tagName.toLowerCase()!=="ul"){this.$editor().wrapSelection("formatBlock","<p>")}l()}});var b=function(h,t,j){var u=function(){j.updateTaBindtaTextElement();j.hidePopover()};h.preventDefault();j.displayElements.popover.css("width","375px");var i=j.displayElements.popoverContainer;i.empty();var o=angular.element('<div class="btn-group" style="padding-right: 6px;">');var m=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">100% </button>');m.on("click",function(v){v.preventDefault();t.css({width:"100%",height:""});u()});var k=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">50% </button>');k.on("click",function(v){v.preventDefault();t.css({width:"50%",height:""});u()});var p=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">25% </button>');p.on("click",function(v){v.preventDefault();t.css({width:"25%",height:""});u()});var r=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">Reset</button>');r.on("click",function(v){v.preventDefault();t.css({width:"",height:""});u()});o.append(m);o.append(k);o.append(p);o.append(r);i.append(o);o=angular.element('<div class="btn-group" style="padding-right: 6px;">');var l=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-left"></i></button>');l.on("click",function(v){v.preventDefault();t.css("float","left");u()});var q=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-right"></i></button>');q.on("click",function(v){v.preventDefault();t.css("float","right");u()});var s=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-justify"></i></button>');s.on("click",function(v){v.preventDefault();t.css("float","");u()});o.append(l);o.append(s);o.append(q);i.append(o);o=angular.element('<div class="btn-group">');var n=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-trash-o"></i></button>');n.on("click",function(v){v.preventDefault();t.remove();u()});o.append(n);i.append(o);j.showPopover(t);j.showResizeOverlay(t)};f("uploadImage",{iconclass:"fa fa-upload",action:function(){var h;h=g.prompt(c.insertImage,"http://还不知道怎么做");if(h&&h!==""&&h!=="http://"){return this.$editor().wrapSelection("uploadImage",h,true)}},onElementSelect:{element:"img",action:b}});f("insertImage",{iconclass:"fa fa-picture-o",action:function(){var h;h=g.prompt(c.insertImage,"http://");if(h&&h!==""&&h!=="http://"){return this.$editor().wrapSelection("insertImage",h,true)}},onElementSelect:{element:"img",action:b}});f("insertVideo",{iconclass:"fa fa-youtube-play",action:function(){var i;i=g.prompt(c.insertVideo,"http://");if(i&&i!==""&&i!=="http://"){var j=i.match(/(\?|&)v=[^&]*/);if(j.length>0){var h="http://www.youtube.com/embed/"+j[0].substring(3);var k='<img class="ta-insert-video" ta-insert-video="'+h+'" contenteditable="false" src="" allowfullscreen="true" width="300" frameborder="0" height="250"/>';return this.$editor().wrapSelection("insertHTML",k,true)}}},onElementSelect:{element:"img",onlyWithAttrs:["ta-insert-video"],action:b}});f("insertLink",{iconclass:"fa fa-link",action:function(){var h;h=g.prompt(c.insertLink,"http://");if(h&&h!==""&&h!=="http://"){return this.$editor().wrapSelection("createLink",h,true)}},activeState:function(h){if(h){return h[0].tagName==="A"}return false},onElementSelect:{element:"a",action:function(n,i,o){n.preventDefault();o.displayElements.popover.css("width","305px");var h=o.displayElements.popoverContainer;h.empty();h.css("line-height","28px");var m=angular.element('<a href="'+i.attr("href")+'" target="_blank">'+i.attr("href")+"</a>");m.css({display:"inline-block","max-width":"200px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","vertical-align":"middle"});h.append(m);var k=angular.element('<div class="btn-group pull-right">');var l=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on"><i class="fa fa-edit icon-edit"></i></button>');l.on("click",function(q){q.preventDefault();var p=g.prompt(c.insertLink,i.attr("href"));if(p&&p!==""&&p!=="http://"){i.attr("href",p);o.updateTaBindtaTextElement()}o.hidePopover()});k.append(l);var j=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on"><i class="fa fa-unlink icon-unlink"></i></button>');j.on("click",function(p){p.preventDefault();i.replaceWith(i.contents());o.updateTaBindtaTextElement();o.hidePopover()});k.append(j);h.append(k);o.showPopover(i)}}})}]);