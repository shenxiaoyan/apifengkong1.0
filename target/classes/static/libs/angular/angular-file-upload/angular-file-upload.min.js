(function(b,a){if(typeof define==="function"&&define.amd){define("angular-file-upload",["angular"],function(c){return a(c)})}else{return a(b)}}(typeof angular==="undefined"?null:angular,function(a){var b=a.module("angularFileUpload",[]);"use strict";b.value("fileUploaderOptions",{url:"/",alias:"file",headers:{},queue:[],progress:0,autoUpload:false,removeAfterUpload:false,method:"POST",filters:[],formData:[],queueLimit:Number.MAX_VALUE,withCredentials:false}).factory("FileUploader",["fileUploaderOptions","$rootScope","$http","$window","$compile",function(j,k,i,d,f){function m(o){var p=a.copy(j);a.extend(this,p,o,{isUploading:false,_nextIndex:0,_failFilterIndex:-1,_directives:{select:[],drop:[],over:[]}});this.filters.unshift({name:"queueLimit",fn:this._queueLimitFilter});this.filters.unshift({name:"folder",fn:this._folderFilter})}m.prototype.isHTML5=!!(d.File&&d.FormData);m.prototype.addToQueue=function(t,p,s){var u=this.isArrayLikeObject(t)?t:[t];var q=this._getFilters(s);var r=this.queue.length;var o=[];a.forEach(u,function(y){var w=new m.FileLikeObject(y);if(this._isValidFile(w,q,p)){var v=new m.FileItem(this,y,p);o.push(v);this.queue.push(v);this._onAfterAddingFile(v)}else{var x=this.filters[this._failFilterIndex];this._onWhenAddingFileFailed(w,x,p)}},this);if(this.queue.length!==r){this._onAfterAddingAll(o);this.progress=this._getTotalProgress()}this._render();if(this.autoUpload){this.uploadAll()}};m.prototype.removeFromQueue=function(q){var o=this.getIndexOfItem(q);var p=this.queue[o];if(p.isUploading){p.cancel()}this.queue.splice(o,1);p._destroy();this.progress=this._getTotalProgress()};m.prototype.clearQueue=function(){while(this.queue.length){this.queue[0].remove()}this.progress=0};m.prototype.uploadItem=function(q){var o=this.getIndexOfItem(q);var p=this.queue[o];var r=this.isHTML5?"_xhrTransport":"_iframeTransport";p._prepareToUploading();if(this.isUploading){return}this.isUploading=true;this[r](p)};m.prototype.cancelItem=function(q){var o=this.getIndexOfItem(q);var p=this.queue[o];var r=this.isHTML5?"_xhr":"_form";if(p&&p.isUploading){p[r].abort()}};m.prototype.uploadAll=function(){var o=this.getNotUploadedItems().filter(function(p){return !p.isUploading});if(!o.length){return}a.forEach(o,function(p){p._prepareToUploading()});o[0].upload()};m.prototype.cancelAll=function(){var o=this.getNotUploadedItems();a.forEach(o,function(p){p.cancel()})};m.prototype.isFile=function(p){var o=d.File;return(o&&p instanceof o)};m.prototype.isFileLikeObject=function(o){return o instanceof m.FileLikeObject};m.prototype.isArrayLikeObject=function(o){return(a.isObject(o)&&"length" in o)};m.prototype.getIndexOfItem=function(o){return a.isNumber(o)?o:this.queue.indexOf(o)};m.prototype.getNotUploadedItems=function(){return this.queue.filter(function(o){return !o.isUploaded})};m.prototype.getReadyItems=function(){return this.queue.filter(function(o){return(o.isReady&&!o.isUploading)}).sort(function(p,o){return p.index-o.index})};m.prototype.destroy=function(){a.forEach(this._directives,function(o){a.forEach(this._directives[o],function(p){p.destroy()},this)},this)};m.prototype.onAfterAddingAll=function(o){};m.prototype.onAfterAddingFile=function(o){};m.prototype.onWhenAddingFileFailed=function(q,p,o){};m.prototype.onBeforeUploadItem=function(o){};m.prototype.onProgressItem=function(o,p){};m.prototype.onProgressAll=function(o){};m.prototype.onSuccessItem=function(q,p,o,r){};m.prototype.onErrorItem=function(q,p,o,r){};m.prototype.onCancelItem=function(q,p,o,r){};m.prototype.onCompleteItem=function(q,p,o,r){};m.prototype.onCompleteAll=function(){};m.prototype._getTotalProgress=function(r){if(this.removeAfterUpload){return r||0}var p=this.getNotUploadedItems().length;var o=p?this.queue.length-p:this.queue.length;var q=100/this.queue.length;var s=(r||0)*q/100;return Math.round(o*q+s)};m.prototype._getFilters=function(o){if(a.isUndefined(o)){return this.filters}if(a.isArray(o)){return o}var p=o.match(/[^\s,]+/g);return this.filters.filter(function(q){return p.indexOf(q.name)!==-1},this)};m.prototype._render=function(){if(!k.$$phase){k.$apply()}};m.prototype._folderFilter=function(o){return !!(o.size||o.type)};m.prototype._queueLimitFilter=function(){return this.queue.length<this.queueLimit};m.prototype._isValidFile=function(p,q,o){this._failFilterIndex=-1;return !q.length?true:q.every(function(r){this._failFilterIndex++;return r.fn.call(this,p,o)},this)};m.prototype._isSuccessCode=function(o){return(o>=200&&o<300)||o===304};m.prototype._transformResponse=function(o,q){var p=this._headersGetter(q);a.forEach(i.defaults.transformResponse,function(r){o=r(o,p)});return o};m.prototype._parseHeaders=function(s){var o={},q,r,p;if(!s){return o}a.forEach(s.split("\n"),function(t){p=t.indexOf(":");q=t.slice(0,p).trim().toLowerCase();r=t.slice(p+1).trim();if(q){o[q]=o[q]?o[q]+", "+r:r}});return o};m.prototype._headersGetter=function(o){return function(p){if(p){return o[p.toLowerCase()]||null}return o}};m.prototype._xhrTransport=function(q){var r=q._xhr=new XMLHttpRequest();var p=new FormData();var o=this;o._onBeforeUploadItem(q);a.forEach(q.formData,function(s){a.forEach(s,function(u,t){p.append(t,u)})});p.append(q.alias,q._file,q.file.name);r.upload.onprogress=function(t){var s=Math.round(t.lengthComputable?t.loaded*100/t.total:0);o._onProgressItem(q,s)};r.onload=function(){var u=o._parseHeaders(r.getAllResponseHeaders());var t=o._transformResponse(r.response,u);var s=o._isSuccessCode(r.status)?"Success":"Error";var v="_on"+s+"Item";o[v](q,t,r.status,u);o._onCompleteItem(q,t,r.status,u)};r.onerror=function(){var t=o._parseHeaders(r.getAllResponseHeaders());var s=o._transformResponse(r.response,t);o._onErrorItem(q,s,r.status,t);o._onCompleteItem(q,s,r.status,t)};r.onabort=function(){var t=o._parseHeaders(r.getAllResponseHeaders());var s=o._transformResponse(r.response,t);o._onCancelItem(q,s,r.status,t);o._onCompleteItem(q,s,r.status,t)};r.open(q.method,q.url,true);r.withCredentials=q.withCredentials;a.forEach(q.headers,function(t,s){r.setRequestHeader(s,t)});r.send(p);this._render()};m.prototype._iframeTransport=function(s){var r=a.element('<form style="display: none;" />');var p=a.element('<iframe name="iframeTransport'+Date.now()+'">');var o=s._input;var q=this;if(s._form){s._form.replaceWith(o)}s._form=r;q._onBeforeUploadItem(s);o.prop("name",s.alias);a.forEach(s.formData,function(t){a.forEach(t,function(w,v){var u=a.element('<input type="hidden" name="'+v+'" />');u.val(w);r.append(u)})});r.prop({action:s.url,method:"POST",target:p.prop("name"),enctype:"multipart/form-data",encoding:"multipart/form-data"});p.bind("load",function(){try{var u=p[0].contentDocument.body.innerHTML}catch(v){}var x={response:u,status:200,dummy:true};var w={};var t=q._transformResponse(x.response,w);q._onSuccessItem(s,t,x.status,w);q._onCompleteItem(s,t,x.status,w)});r.abort=function(){var v={status:0,dummy:true};var u={};var t;p.unbind("load").prop("src","javascript:false;");r.replaceWith(o);q._onCancelItem(s,t,v.status,u);q._onCompleteItem(s,t,v.status,u)};o.after(r);r.append(o).append(p);r[0].submit();this._render()};m.prototype._onWhenAddingFileFailed=function(q,p,o){this.onWhenAddingFileFailed(q,p,o)};m.prototype._onAfterAddingFile=function(o){this.onAfterAddingFile(o)};m.prototype._onAfterAddingAll=function(o){this.onAfterAddingAll(o)};m.prototype._onBeforeUploadItem=function(o){o._onBeforeUpload();this.onBeforeUploadItem(o)};m.prototype._onProgressItem=function(q,o){var p=this._getTotalProgress(o);this.progress=p;q._onProgress(o);this.onProgressItem(q,o);this.onProgressAll(p);this._render()};m.prototype._onSuccessItem=function(q,p,o,r){q._onSuccess(p,o,r);this.onSuccessItem(q,p,o,r)};m.prototype._onErrorItem=function(q,p,o,r){q._onError(p,o,r);this.onErrorItem(q,p,o,r)};m.prototype._onCancelItem=function(q,p,o,r){q._onCancel(p,o,r);this.onCancelItem(q,p,o,r)};m.prototype._onCompleteItem=function(r,q,p,s){r._onComplete(q,p,s);this.onCompleteItem(r,q,p,s);var o=this.getReadyItems()[0];this.isUploading=false;if(a.isDefined(o)){o.upload();return}this.onCompleteAll();this.progress=this._getTotalProgress();this._render()};m.isFile=m.prototype.isFile;m.isFileLikeObject=m.prototype.isFileLikeObject;m.isArrayLikeObject=m.prototype.isArrayLikeObject;m.isHTML5=m.prototype.isHTML5;m.inherit=function(p,o){p.prototype=Object.create(o.prototype);p.prototype.constructor=p;p.super_=o};m.FileLikeObject=l;m.FileItem=n;m.FileDirective=c;m.FileSelect=g;m.FileDrop=e;m.FileOver=h;function l(p){var o=a.isElement(p);var s=o?p.value:p;var r=a.isString(s)?"FakePath":"Object";var q="_createFrom"+r;this[q](s)}l.prototype._createFromFakePath=function(o){this.lastModifiedDate=null;this.size=null;this.type="like/"+o.slice(o.lastIndexOf(".")+1).toLowerCase();this.name=o.slice(o.lastIndexOf("/")+o.lastIndexOf("\\")+2)};l.prototype._createFromObject=function(o){this.lastModifiedDate=a.copy(o.lastModifiedDate);this.size=o.size;this.type=o.type;this.name=o.name};function n(s,t,p){var r=a.isElement(t);var o=r?a.element(t):null;var q=!r?t:null;a.extend(this,{url:s.url,alias:s.alias,headers:a.copy(s.headers),formData:a.copy(s.formData),removeAfterUpload:s.removeAfterUpload,withCredentials:s.withCredentials,method:s.method},p,{uploader:s,file:new m.FileLikeObject(t),isReady:false,isUploading:false,isUploaded:false,isSuccess:false,isCancel:false,isError:false,progress:0,index:null,_file:q,_input:o});if(o){this._replaceNode(o)}}n.prototype.upload=function(){this.uploader.uploadItem(this)};n.prototype.cancel=function(){this.uploader.cancelItem(this)};n.prototype.remove=function(){this.uploader.removeFromQueue(this)};n.prototype.onBeforeUpload=function(){};n.prototype.onProgress=function(o){};n.prototype.onSuccess=function(p,o,q){};n.prototype.onError=function(p,o,q){};n.prototype.onCancel=function(p,o,q){};n.prototype.onComplete=function(p,o,q){};n.prototype._onBeforeUpload=function(){this.isReady=true;this.isUploading=true;this.isUploaded=false;this.isSuccess=false;this.isCancel=false;this.isError=false;this.progress=0;this.onBeforeUpload()};n.prototype._onProgress=function(o){this.progress=o;this.onProgress(o)};n.prototype._onSuccess=function(p,o,q){this.isReady=false;this.isUploading=false;this.isUploaded=true;this.isSuccess=true;this.isCancel=false;this.isError=false;this.progress=100;this.index=null;this.onSuccess(p,o,q)};n.prototype._onError=function(p,o,q){this.isReady=false;this.isUploading=false;this.isUploaded=true;this.isSuccess=false;this.isCancel=false;this.isError=true;this.progress=0;this.index=null;this.onError(p,o,q)};n.prototype._onCancel=function(p,o,q){this.isReady=false;this.isUploading=false;this.isUploaded=false;this.isSuccess=false;this.isCancel=true;this.isError=false;this.progress=0;this.index=null;this.onCancel(p,o,q)};n.prototype._onComplete=function(p,o,q){this.onComplete(p,o,q);if(this.removeAfterUpload){this.remove()}};n.prototype._destroy=function(){if(this._input){this._input.remove()}if(this._form){this._form.remove()}delete this._form;delete this._input};n.prototype._prepareToUploading=function(){this.index=this.index||++this.uploader._nextIndex;this.isReady=true};n.prototype._replaceNode=function(o){var p=f(o.clone())(o.scope());p.prop("value",null);o.css("display","none");o.after(p)};function c(o){a.extend(this,o);this.uploader._directives[this.prop].push(this);this._saveLinks();this.bind()}c.prototype.events={};c.prototype.bind=function(){for(var o in this.events){var p=this.events[o];this.element.bind(o,this[p])}};c.prototype.unbind=function(){for(var o in this.events){this.element.unbind(o,this.events[o])}};c.prototype.destroy=function(){var o=this.uploader._directives[this.prop].indexOf(this);this.uploader._directives[this.prop].splice(o,1);this.unbind()};c.prototype._saveLinks=function(){for(var o in this.events){var p=this.events[o];this[p]=this[p].bind(this)}};m.inherit(g,c);function g(o){g.super_.apply(this,arguments);if(!this.uploader.isHTML5){this.element.removeAttr("multiple")}this.element.prop("value",null)}g.prototype.events={$destroy:"destroy",change:"onChange"};g.prototype.prop="select";g.prototype.getOptions=function(){};g.prototype.getFilters=function(){};g.prototype.isEmptyAfterSelection=function(){return !!this.element.attr("multiple")};g.prototype.onChange=function(){var q=this.uploader.isHTML5?this.element[0].files:this.element[0];var o=this.getOptions();var p=this.getFilters();if(!this.uploader.isHTML5){this.destroy()}this.uploader.addToQueue(q,o,p);if(this.isEmptyAfterSelection()){this.element.prop("value",null)}};m.inherit(e,c);function e(o){e.super_.apply(this,arguments)}e.prototype.events={$destroy:"destroy",drop:"onDrop",dragover:"onDragOver",dragleave:"onDragLeave"};e.prototype.prop="drop";e.prototype.getOptions=function(){};e.prototype.getFilters=function(){};e.prototype.onDrop=function(r){var o=this._getTransfer(r);if(!o){return}var p=this.getOptions();var q=this.getFilters();this._preventAndStop(r);a.forEach(this.uploader._directives.over,this._removeOverClass,this);this.uploader.addToQueue(o.files,p,q)};e.prototype.onDragOver=function(p){var o=this._getTransfer(p);if(!this._haveFiles(o.types)){return}o.dropEffect="copy";this._preventAndStop(p);a.forEach(this.uploader._directives.over,this._addOverClass,this)};e.prototype.onDragLeave=function(o){if(o.currentTarget!==this.element[0]){return}this._preventAndStop(o);a.forEach(this.uploader._directives.over,this._removeOverClass,this)};e.prototype._getTransfer=function(o){return o.dataTransfer?o.dataTransfer:o.originalEvent.dataTransfer};e.prototype._preventAndStop=function(o){o.preventDefault();o.stopPropagation()};e.prototype._haveFiles=function(o){if(!o){return false}if(o.indexOf){return o.indexOf("Files")!==-1}else{if(o.contains){return o.contains("Files")}else{return false}}};e.prototype._addOverClass=function(o){o.addOverClass()};e.prototype._removeOverClass=function(o){o.removeOverClass()};m.inherit(h,c);function h(o){h.super_.apply(this,arguments)}h.prototype.events={$destroy:"destroy"};h.prototype.prop="over";h.prototype.overClass="nv-file-over";h.prototype.addOverClass=function(){this.element.addClass(this.getOverClass())};h.prototype.removeOverClass=function(){this.element.removeClass(this.getOverClass())};h.prototype.getOverClass=function(){return this.overClass};return m}]).directive("nvFileSelect",["$parse","FileUploader",function(c,d){return{link:function(h,g,e){var i=h.$eval(e.uploader);if(!(i instanceof d)){throw new TypeError('"Uploader" must be an instance of FileUploader')}var f=new d.FileSelect({uploader:i,element:g});f.getOptions=c(e.options).bind(f,h);f.getFilters=function(){return e.filters}}}}]).directive("nvFileDrop",["$parse","FileUploader",function(c,d){return{link:function(h,g,e){var i=h.$eval(e.uploader);if(!(i instanceof d)){throw new TypeError('"Uploader" must be an instance of FileUploader')}if(!i.isHTML5){return}var f=new d.FileDrop({uploader:i,element:g});f.getOptions=c(e.options).bind(f,h);f.getFilters=function(){return e.filters}}}}]).directive("nvFileOver",["FileUploader",function(c){return{link:function(g,f,d){var h=g.$eval(d.uploader);if(!(h instanceof c)){throw new TypeError('"Uploader" must be an instance of FileUploader')}var e=new c.FileOver({uploader:h,element:f});e.getOverClass=function(){return d.overClass||this.overClass}}}}]);return b}));