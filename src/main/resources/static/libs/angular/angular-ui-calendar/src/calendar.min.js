angular.module("ui.calendar",[]).constant("uiCalendarConfig",{calendars:{}}).controller("uiCalendarCtrl",["$scope","$locale",function(d,f){var e=d.eventSources,g=d.calendarWatchEvent?d.calendarWatchEvent:angular.noop,c=function(i){return function(){if(d.$root.$$phase){return i.apply(this,arguments)}else{var k=arguments;var j=this;return d.$root.$apply(function(){return i.apply(j,k)})}}};var b=1;this.eventFingerprint=function(i){if(!i._id){i._id=b++}return""+i._id+(i.id||"")+(i.title||"")+(i.url||"")+(+i.start||"")+(+i.end||"")+(i.allDay||"")+(i.className||"")+g({event:i})||""};var a=1,h=1;this.sourceFingerprint=function(k){var i=""+(k.__id||(k.__id=a++)),j=angular.isObject(k)&&k.events;if(j){i=i+"-"+(j.__id||(j.__id=h++))}return i};this.allEvents=function(){var j=[];for(var m=0,n=e.length;m<n;m++){var p=e[m];if(angular.isArray(p)){j.push(p)}else{if(angular.isObject(p)&&angular.isArray(p.events)){var k={};for(var l in p){if(l!=="_id"&&l!=="events"){k[l]=p[l]}}for(var o=0;o<p.events.length;o++){angular.extend(p.events[o],k)}j.push(p.events)}}}return Array.prototype.concat.apply([],j)};this.changeWatcher=function(i,l){var j;var m=function(){var u=angular.isFunction(i)?i():i;var p=[],r,s;for(var q=0,t=u.length;q<t;q++){s=u[q];r=l(s);n[r]=s;p.push(r)}return p};var k=function(r,q){var p=[],t={},s,u;for(s=0,u=q.length;s<u;s++){t[q[s]]=true}for(s=0,u=r.length;s<u;s++){if(!t[r[s]]){p.push(r[s])}}return p};var n={};var o=function(z,x){var u,r,q,s;var t={};var p=k(x,z);for(u=0,r=p.length;u<r;u++){var v=p[u];q=n[v];delete n[v];var w=l(q);if(w===v){j.onRemoved(q)}else{t[w]=v;j.onChanged(q)}}var y=k(z,x);for(u=0,r=y.length;u<r;u++){s=y[u];q=n[s];if(!t[s]){j.onAdded(q)}}};return j={subscribe:function(q,p){q.$watch(m,function(t,s){var r=!(p&&p(t,s)===false);if(r){o(t,s)}},true)},onAdded:angular.noop,onChanged:angular.noop,onRemoved:angular.noop}};this.getFullCalendarConfig=function(j,k){var i={};angular.extend(i,k);angular.extend(i,j);angular.forEach(i,function(m,l){if(typeof m==="function"){i[l]=c(i[l])}});return i};this.getLocaleConfig=function(i){if(!i.lang||i.useNgLocale){var k=function(n){var m,l;m=[];for(l in n){m[l]=n[l]}return m};var j=f.DATETIME_FORMATS;return{monthNames:k(j.MONTH),monthNamesShort:k(j.SHORTMONTH),dayNames:k(j.DAY),dayNamesShort:k(j.SHORTDAY)}}return{}}}]).directive("uiCalendar",["uiCalendarConfig",function(a){return{restrict:"A",scope:{eventSources:"=ngModel",calendarWatchEvent:"&"},controller:"uiCalendarCtrl",link:function(k,f,i,e){var b=k.eventSources,d=false,c,h=e.changeWatcher(b,e.sourceFingerprint),j=e.changeWatcher(e.allEvents,e.eventFingerprint),l=null;function g(){var p=i.uiCalendar?k.$parent.$eval(i.uiCalendar):{},n;n=e.getFullCalendarConfig(p,a);var m=e.getLocaleConfig(n);angular.extend(m,n);l={eventSources:b};angular.extend(l,m);l.calendars=null;var r={};for(var q in l){if(q!=="eventSources"){r[q]=l[q]}}return JSON.stringify(r)}k.destroy=function(){if(c&&c.fullCalendar){c.fullCalendar("destroy")}if(i.calendar){c=a.calendars[i.calendar]=$(f).html("")}else{c=$(f).html("")}};k.init=function(){c.fullCalendar(l);if(i.calendar){a.calendars[i.calendar]=c}};h.onAdded=function(m){c.fullCalendar("addEventSource",m);d=true};h.onRemoved=function(m){c.fullCalendar("removeEventSource",m);d=true};h.onChanged=function(m){c.fullCalendar("refetchEvents");d=true};j.onAdded=function(m){c.fullCalendar("renderEvent",m,(m.stick?true:false))};j.onRemoved=function(m){c.fullCalendar("removeEvents",m._id)};j.onChanged=function(o){var n=c.fullCalendar("clientEvents",o._id);for(var m=0;m<n.length;m++){var p=n[m];p=angular.extend(p,o);c.fullCalendar("updateEvent",p)}};h.subscribe(k);j.subscribe(k,function(){if(d===true){d=false;return false}});k.$watch(g,function(n,m){k.destroy();k.init()})}}}]);