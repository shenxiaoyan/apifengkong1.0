(function(a,b){if(typeof define==="function"&&define.amd){define(["angular"],b)}else{if(typeof exports==="object"){module.exports=b(require("angular"))}else{b(a.angular)}}}(this,function(b){return b.module("ngStorage",[]).factory("$localStorage",a("localStorage")).factory("$sessionStorage",a("sessionStorage"));function a(c){return["$rootScope","$window","$log","$timeout",function(q,g,s,h){function t(l){var e;try{e=g[l]}catch(k){e=false}if(e&&l==="localStorage"){var i="__"+Math.round(Math.random()*10000000);try{localStorage.setItem(i,i);localStorage.removeItem(i)}catch(k){e=false}}return e}var f=t(c)||(s.warn("This browser does not support Web Storage!"),{setItem:function(){},getItem:function(){}}),d={$default:function(i){for(var e in i){b.isDefined(d[e])||(d[e]=i[e])}return d},$reset:function(i){for(var e in d){"$"===e[0]||(delete d[e]&&f.removeItem("ngStorage-"+e))}return d.$default(i)}},p,r;try{f=g[c];f.length}catch(o){s.warn("This browser does not support Web Storage!");f={}}for(var n=0,j=f.length,m;n<j;n++){(m=f.key(n))&&"ngStorage-"===m.slice(0,10)&&(d[m.slice(10)]=b.fromJson(f.getItem(m)))}p=b.copy(d);q.$watch(function(){var e;r||(r=h(function(){r=null;if(!b.equals(d,p)){e=b.copy(p);b.forEach(d,function(u,l){b.isDefined(u)&&"$"!==l[0]&&f.setItem("ngStorage-"+l,b.toJson(u));delete e[l]});for(var i in e){f.removeItem("ngStorage-"+i)}p=b.copy(d)}},100,false))});g.addEventListener&&g.addEventListener("storage",function(e){if("ngStorage-"===e.key.slice(0,10)){e.newValue?d[e.key.slice(10)]=b.fromJson(e.newValue):delete d[e.key.slice(10)];p=b.copy(d);q.$apply()}});return d}]}}));